<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirportHub - Plus Ultra Airlines</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- ✅ 2. CONFIGURACIÓN DESPUÉS -->
<script>
  tailwind.config = {
    safelist: [
      'bg-red-100','bg-red-600',
      'bg-green-100','bg-green-600',
      'bg-purple-100','bg-purple-600',
      'bg-orange-100','bg-orange-600',
      'text-red-600','text-green-600','text-purple-600','text-orange-600',
      'bg-blue-100','bg-gray-100',
      'text-blue-600','text-blue-700',
      'text-purple-700','text-orange-700','text-gray-600','text-gray-700',
    ]
  }
</script>

<!-- ✅ 3. REACT Y REACT-DOM -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<!-- ✅ 4. LUCIDE REACT - VERSIÓN CORRECTA -->
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

<!-- ✅ 5. BABEL -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        
        const { useState, useEffect } = React;
    
    // ✅ CAMBIO: Usar lucide en lugar de lucideReact
    // ✅ IMPORTAR TODOS LOS ICONOS DE LUCIDE
// ✅ SOLUCIÓN CORRECTA: Crear componentes React para cada icono
// ✅ CORRECCIÓN: createLucideComponent
// ✅ CORRECCIÓN: createLucideComponent sin cleanup
const createLucideComponent = (iconName) => {
  return React.forwardRef((props, ref) => {
    const { size = 24, className = "", ...rest } = props;
    const iconRef = React.useRef(null);
    
    React.useEffect(() => {
      if (iconRef.current && window.lucide && window.lucide[iconName]) {
        iconRef.current.setAttribute('data-lucide', iconName);
        window.lucide.createIcons({ 
          icons: { [iconName]: window.lucide[iconName] },
          attrs: { 
            width: size, 
            height: size,
            'stroke-width': 2
          }
        });
      }
    }, [size]);
    
    return React.createElement('i', {
      ref: iconRef,
      'data-lucide': iconName,
      className: className,
      style: { 
        display: 'inline-flex',
        width: `${size}px`,
        height: `${size}px`
      },
      ...rest
    });
  });
};

// ✅ SOLUCIÓN DEFINITIVA: Componentes SVG en lugar de Lucide UMD
const createIconComponent = (svgPath) => {
  return ({ size = 24, className = "", ...props }) => (
    <svg
      width={size}
      height={size}
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      className={className}
      {...props}
    >
      {svgPath}
    </svg>
  );
};

// Definir todos los iconos como componentes SVG
const Plane = createIconComponent(<path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z" />);

const Menu = createIconComponent(<><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></>);

const X = createIconComponent(<><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>);

const User = createIconComponent(<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>);

const Lock = createIconComponent(<><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></>);

const Eye = createIconComponent(<><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" /><circle cx="12" cy="12" r="3" /></>);

const EyeOff = createIconComponent(<><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24" /><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68" /><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61" /><line x1="2" x2="22" y1="2" y2="22" /></>);

const Mail = createIconComponent(<><rect width="20" height="16" x="2" y="4" rx="2" /><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" /></>);

const Shield = createIconComponent(<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" />);

const ArrowLeft = createIconComponent(<><path d="m12 19-7-7 7-7" /><path d="M19 12H5" /></>);

const Users = createIconComponent(<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>);

const Building2 = createIconComponent(<><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z" /><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2" /><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2" /><path d="M10 6h4" /><path d="M10 10h4" /><path d="M10 14h4" /><path d="M10 18h4" /></>);

const Building = createIconComponent(<><rect width="16" height="20" x="4" y="2" rx="2" ry="2" /><path d="M9 22v-4h6v4" /><path d="M8 6h.01" /><path d="M16 6h.01" /><path d="M12 6h.01" /><path d="M12 10h.01" /><path d="M12 14h.01" /><path d="M16 10h.01" /><path d="M16 14h.01" /><path d="M8 10h.01" /><path d="M8 14h.01" /></>);

const Home = createIconComponent(<><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></>);

const LogOut = createIconComponent(<><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" x2="9" y1="12" y2="12" /></>);

const Filter = createIconComponent(<polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />);

const Download = createIconComponent(<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>);

const XCircle = createIconComponent(<><circle cx="12" cy="12" r="10" /><path d="m15 9-6 6" /><path d="m9 9 6 6" /></>);

const FileText = createIconComponent(<><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" /><path d="M14 2v4a2 2 0 0 0 2 2h4" /><path d="M10 9H8" /><path d="M16 13H8" /><path d="M16 17H8" /></>);

const Check = createIconComponent(<path d="M20 6 9 17l-5-5" />);

const Hotel = createIconComponent(<><path d="M10 22v-6.57" /><path d="M12 11h.01" /><path d="M12 7h.01" /><path d="M14 15.43V22" /><path d="M15 16a5 5 0 0 0-6 0" /><path d="M16 11h.01" /><path d="M16 7h.01" /><path d="M8 11h.01" /><path d="M8 7h.01" /><rect x="4" y="2" width="16" height="20" rx="2" /></>);

const Truck = createIconComponent(<><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2" /><path d="M15 18H9" /><path d="M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14" /><circle cx="17" cy="18" r="2" /><circle cx="7" cy="18" r="2" /></>);

const Utensils = createIconComponent(<><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" /><path d="M7 2v20" /><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" /></>);

const Calendar = createIconComponent(<><path d="M8 2v4" /><path d="M16 2v4" /><rect width="18" height="18" x="3" y="4" rx="2" /><path d="M3 10h18" /></>);

const MapPin = createIconComponent(<><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></>);

const AlertCircle = createIconComponent(<><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></>);

const Upload = createIconComponent(<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" x2="12" y1="3" y2="15" /></>);

const Loader2 = createIconComponent(<path d="M21 12a9 9 0 1 1-6.219-8.56" />);

const Square = createIconComponent(<rect width="18" height="18" x="3" y="3" rx="2" />);

const CheckSquare = createIconComponent(<><path d="m9 11 3 3L22 4" /><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" /></>);

const Send = createIconComponent(<><path d="m22 2-7 20-4-9-9-4Z" /><path d="M22 2 11 13" /></>);

const Edit = createIconComponent(<><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z" /></>);

const Save = createIconComponent(<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></>);

const Phone = createIconComponent(<path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />);

const AlertTriangle = createIconComponent(<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></>);

    
function AirportApp() {
  // Estados básicos
  const [currentView, setCurrentView] = useState("login");
  const [userRole, setUserRole] = useState(null);
  const [showPassword, setShowPassword] = useState(false);
  // const [sidebarOpen, setSidebarOpen] = useState(true);
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [isScanning, setIsScanning] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [saveSuccess, setSaveSuccess] = useState(false);
  const [scannedData, setScannedData] = useState(null);
  const [recoveryEmail, setRecoveryEmail] = useState("");
  const [recoverySuccess, setRecoverySuccess] = useState(false);
  const [newPassword, setNewPassword] = useState("");
  const [confirmPassword, setConfirmPassword] = useState("");
  const [showNewPassword, setShowNewPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [isGeneratingPDF, setIsGeneratingPDF] = useState(false);
  const [isSendingEmail, setIsSendingEmail] = useState(false);
  const [emailSent, setEmailSent] = useState(false);
  const [pdfCorrelativo, setPdfCorrelativo] = useState(100702);
  const [editingCompanyId, setEditingCompanyId] = useState(null);

  const [usedRooms, setUsedRooms] = useState({});

  // NUEVO: Estados para la vista de detalle
  const [selectedVoucher, setSelectedVoucher] = useState(null);
  const [isEditingVoucher, setIsEditingVoucher] = useState(false);
  const [editedVoucherData, setEditedVoucherData] = useState(null);
  const [hotelCapacities, setHotelCapacities] = useState({});

  // ✅ AGREGAR ESTE NUEVO ESTADO AQUÍ
  const [hotelPrices, setHotelPrices] = useState({});
  // AGREGAR estos nuevos estados al inicio (línea ~30 aproximadamente)
  const [multiplePassengers, setMultiplePassengers] = useState([]);

  // Estado para rastrear PNRs que ya tienen vouchers generados
  const [generatedPNRs, setGeneratedPNRs] = useState([]);

  // ✅ NUEVO: Agregar estos estados al inicio del componente (junto con los otros estados)
  const [showDuplicatePNRModal, setShowDuplicatePNRModal] = useState(false);
  const [duplicatePNRInfo, setDuplicatePNRInfo] = useState(null);

  // ✅ NUEVO: Contador de intentos de escaneo (independiente de generatedPNRs)
  const [scanAttempts, setScanAttempts] = useState(0);

  //Cambios
  const [adminView, setAdminView] = useState("dashboard"); // dashboard, providers, users
  const [users, setUsers] = useState([
    {
      id: 1,
      nombre: "Juan Pérez Martínez",
      email: "juan.perez@plusultra.com",
      telefono: "+51 987 654 321",
      rol: "airportLeader",
      estado: "activo",
      codigoEmpleado: "EMP001",
      fechaRegistro: "2024-01-15",
    },
    {
      id: 2,
      nombre: "María García López",
      email: "maria.garcia@plusultra.com",
      telefono: "+51 987 654 322",
      rol: "agent",
      estado: "activo",
      codigoEmpleado: "EMP002",
      fechaRegistro: "2024-01-20",
    },
    {
      id: 3,
      nombre: "Carlos Rodríguez Silva",
      email: "carlos.rodriguez@plusultra.com",
      telefono: "+51 987 654 323",
      rol: "airline",
      estado: "inactivo",
      codigoEmpleado: "EMP003",
      fechaRegistro: "2024-02-01",
    },
  ]);
  const [userData, setUserData] = useState({
    nombre: "",
    email: "",
    telefono: "",
    rol: "",
    estado: "activo",
    codigoEmpleado: "",
    password: "",
  });
  const [editingUserId, setEditingUserId] = useState(null);
  const [userSearchFilter, setUserSearchFilter] = useState("");


// ========================================
  // FUNCIÓN PARA GUARDAR/ACTUALIZAR USUARIO
  // ========================================
  const handleSaveUser = () => {
    setIsSaving(true);
    setTimeout(() => {
      if (editingUserId) {
        setUsers(
          users.map((u) =>
            u.id === editingUserId ? { ...u, ...userData } : u,
          ),
        );
        setEditingUserId(null);
      } else {
        const newUser = {
          id: Math.max(...users.map((u) => u.id), 0) + 1,
          ...userData,
          fechaRegistro: new Date().toISOString().split("T")[0],
        };
        setUsers([...users, newUser]);
      }

      setIsSaving(false);
      setSaveSuccess(true);
      setTimeout(() => {
        setSaveSuccess(false);
        setUserData({
          nombre: "",
          email: "",
          telefono: "",
          rol: "",
          estado: "activo",
          codigoEmpleado: "",
          password: "",
        });
      }, 3000);
    }, 1500);
  };

  // ========================================
  // FUNCIÓN PARA OBTENER LABEL Y COLOR DEL ROL
  // ========================================
  const getRoleInfo = (role) => {
    const roles = {
      airportLeader: { label: "Líder Aeroportuario", color: "red" },
      agent: { label: "Agente", color: "green" },
      airline: { label: "Línea Aérea", color: "purple" },
      admin: { label: "Administrador", color: "orange" },
    };
    return roles[role] || { label: role, color: "gray" };
  };




  // Datos del vuelo
  const [flightData, setFlightData] = useState({
    flightNumber: "",
    airline: "Plus Ultra",
    date: "",
    time: "",
    status: "programado",
    notes: "",
  });

  // ✅✅✅ AGREGAR AQUÍ ✅✅✅
useEffect(() => {
  // Cerrar sidebar al cambiar de vista o rol
  setSidebarOpen(false);
}, [currentView, userRole]);


  // NUEVO FLUJO: Recursos habilitados por el Líder para el día
  const [enabledResources, setEnabledResources] = useState({
    hotels: [],
    transports: [],
    restaurants: [],
  });

  // Control de recursos usados
  const [usedResources, setUsedResources] = useState({
    hotels: [],
    transports: [],
    restaurants: [],
  });

  // Master Data
  const [masterHotels, setMasterHotels] = useState([
    {
      id: 1,
      name: "Novotel",
      address: "Av. José Pardo 879, Miraflores",
      phone: "+51 1 610 8000",
      email: "reservas.novotel@accor.com",
      activo: true,
    },
    {
      id: 2,
      name: "Radisson Decapolis",
      address: "Av. 28 de Julio 151, Miraflores",
      phone: "+51 1 625 1200",
      email: "info@radisson.com.pe",
      activo: true,
    },
    {
      id: 3,
      name: "Hotel Los Delfines",
      address: "Los Eucaliptos 555, San Isidro",
      phone: "+51 1 215 7000",
      email: "reservas@losdelfines.com",
      activo: true,
    },
    {
      id: 4,
      name: "Sheraton Lima Hotel",
      address: "Paseo de la República 170, Lima",
      phone: "+51 1 315 5000",
      email: "reservas.sheraton@marriott.com",
      activo: true,
    },
  ]);

  const [masterTransports, setMasterTransports] = useState([
    {
      id: 1,
      name: "Transportes Rápidos SAC",
      type: "Bus",
      capacity: "45 pasajeros",
      phone: "+51 1 234 5678",
      email: "operaciones@rapidossac.com",
      activo: true,
    },
    {
      id: 2,
      name: "Lima Transfer VIP",
      type: "Van",
      capacity: "12 pasajeros",
      phone: "+51 1 345 6789",
      email: "reservas@limatransfervip.com",
      activo: true,
    },
    {
      id: 3,
      name: "Taxi Green",
      type: "Taxi",
      capacity: "4 pasajeros",
      phone: "+51 1 456 7890",
      email: "contacto@taxigreen.pe",
      activo: true,
    },
    {
      id: 4,
      name: "Remisse Premium",
      type: "Auto",
      capacity: "4 pasajeros",
      phone: "+51 1 567 8901",
      email: "info@remissepremium.pe",
      activo: true,
    },
  ]);

  const [masterRestaurants, setMasterRestaurants] = useState([
    {
      id: 1,
      name: "La Rosa Náutica",
      cuisine: "Peruana",
      address: "Espigón 4, Miraflores",
      phone: "+51 1 445 0149",
      email: "reservas@larosanautica.com",
      activo: true,
    },
    {
      id: 2,
      name: "Central Restaurante",
      cuisine: "Contemporánea",
      address: "Calle Santa Isabel 376",
      phone: "+51 1 242 8515",
      email: "info@centralrestaurante.com.pe",
      activo: true,
    },
    {
      id: 3,
      name: "Maido",
      cuisine: "Nikkei",
      address: "Calle San Martín 399, Miraflores",
      phone: "+51 1 446 2512",
      email: "reservas@maido.pe",
      activo: true,
    },
    {
      id: 4,
      name: "Astrid & Gastón",
      cuisine: "Alta Cocina",
      address: "Av. Paz Soldán 290, San Isidro",
      phone: "+51 1 442 2777",
      email: "reservas@astridygaston.com",
      activo: true,
    },
  ]);

  const [companyData, setCompanyData] = useState({
    razonSocial: "",
    ruc: "",
    direccion: "",
    tipoEmpresa: "",
    telefono: "",
    email: "",
  });

  const [registeredCompanies, setRegisteredCompanies] = useState([]);

  // Datos del pasajero con PNR, seat, gate
  const [passengerData, setPassengerData] = useState({
    name: "",
    documentNumber: "",
    pnr: "",
    seat: "",
    gate: "",
    emissionDate: "",
    emissionPlace: "",
    selectedHotel: "",
    selectedTransport: "",
    selectedRestaurant: "",
    hotelServices: {
      desayuno: false,
      almuerzo: false,
      snack: false,
      cena: false,
    },
    email: "",
    roomSelection: { simple: 0, doble: 0, matrimonial: 0 },
  });

  const [registeredVouchers, setRegisteredVouchers] = useState([]);

  // Filtros mejorados con transporte, restaurante y PNR
  const [filters, setFilters] = useState({
    correlativo: "",
    passenger: "",
    flight: "",
    hotel: "",
    transport: "",
    restaurant: "",
    pnr: "",
    dateFrom: "",
    dateTo: "",
    agent: "",
  });

  // Funciones para el LÍDER AEROPORTUARIO: toggle de recursos
  const toggleHotelSelection = (hotelId) => {
    const newHotels = enabledResources.hotels.includes(hotelId)
      ? enabledResources.hotels.filter((id) => id !== hotelId)
      : [...enabledResources.hotels, hotelId];
    setEnabledResources({ ...enabledResources, hotels: newHotels });

    // Si se deshabilita el hotel, eliminar su capacidad
    if (enabledResources.hotels.includes(hotelId)) {
      const newCapacities = { ...hotelCapacities };
      delete newCapacities[hotelId];
      setHotelCapacities(newCapacities);
    }
  };

  const updateHotelCapacity = (hotelId, capacity) => {
    setHotelCapacities({
      ...hotelCapacities,
      [hotelId]: parseInt(capacity) || 0,
    });
  };

  const [filteredVouchers, setFilteredVouchers] = useState([]);

  // AGREGAR esta función después de handleImageUpload
  const handleAddNextPassenger = () => {
    if (!passengerData.name || !passengerData.pnr || !passengerData.email) {
      alert("Por favor complete al menos el nombre, PNR y email del pasajero");
      return;
    }

      // ✅ CALCULAR COSTO DEL HOTEL
  const hotelCost = calculateHotelCost(
    parseInt(passengerData.selectedHotel),
    passengerData.roomSelection
  );

    const newPassenger = {
      id: Date.now(),
      name: passengerData.name,
      pnr: passengerData.pnr,
      email: passengerData.email,
      selectedHotel: passengerData.selectedHotel, // ✅ AGREGAR
      hotelCost: hotelCost, // ✅ AGREGAR
      roomSelection: passengerData.roomSelection || {
        simple: 0,
        doble: 0,
        matrimonial: 0,
      },
    };

    setMultiplePassengers([...multiplePassengers, newPassenger]);

    // Limpiar datos del pasajero Y scannedData
    setPassengerData({
      ...passengerData,
      name: "",
      documentNumber: "",
      pnr: "",
      seat: "",
      gate: "",
      email: "",
      roomSelection: { simple: 0, doble: 0, matrimonial: 0 },
    });
    setScannedData(null); // ✅ AGREGAR ESTA LÍNEA
  };

  // Efecto para filtrar vouchers
  useEffect(() => {
    let filtered = [...registeredVouchers];
    if (filters.correlativo)
      filtered = filtered.filter((v) =>
        v.correlativo.toLowerCase().includes(filters.correlativo.toLowerCase()),
      );
    if (filters.passenger)
      filtered = filtered.filter((v) =>
        v.passenger.toLowerCase().includes(filters.passenger.toLowerCase()),
      );
    if (filters.flight)
      filtered = filtered.filter((v) =>
        v.flight.toLowerCase().includes(filters.flight.toLowerCase()),
      );
    if (filters.hotel)
      filtered = filtered.filter((v) =>
        (v.pdfData?.hotel?.name || "")
          .toLowerCase()
          .includes(filters.hotel.toLowerCase()),
      );
    if (filters.transport)
      filtered = filtered.filter((v) =>
        (v.pdfData?.transport?.name || "")
          .toLowerCase()
          .includes(filters.transport.toLowerCase()),
      );
    if (filters.restaurant)
      filtered = filtered.filter((v) =>
        (v.pdfData?.restaurant?.name || "")
          .toLowerCase()
          .includes(filters.restaurant.toLowerCase()),
      );
    if (filters.pnr)
      filtered = filtered.filter((v) =>
        (v.pdfData?.passenger?.pnr || "")
          .toLowerCase()
          .includes(filters.pnr.toLowerCase()),
      );
    if (filters.dateFrom)
      filtered = filtered.filter((v) => v.date >= filters.dateFrom);
    if (filters.dateTo)
      filtered = filtered.filter((v) => v.date <= filters.dateTo);
    if (filters.agent)
      filtered = filtered.filter((v) =>
        (v.agent || "").toLowerCase().includes(filters.agent.toLowerCase()),
      );
    setFilteredVouchers(filtered);
  }, [filters, registeredVouchers]);

  // OCR de Plus Ultra con datos reales
  const handleImageUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    setIsScanning(true);
    setSaveSuccess(false);

    // ✅ INCREMENTAR el contador de intentos de escaneo
    const currentAttempt = scanAttempts;
    setScanAttempts(currentAttempt + 1);

    setTimeout(() => {
      // Array de ejemplos de pasajeros
      const passengerExamples = [
        {
          name: "INFANTESILVA/DOMINIK",
          pnr: "WSVFKR",
          email: "dominik@gmail.com",
        },
        { name: "GARCIA/MARIA", pnr: "ABC123", email: "maria@gmail.com" },
        { name: "RODRIGUEZ/CARLOS", pnr: "XYZ789", email: "carlos@gmail.com" },
        { name: "LOPEZ/JUAN", pnr: "DEF456", email: "juan@gmail.com" },
        { name: "MARTINEZ/ANA", pnr: "GHI012", email: "ana@gmail.com" },
      ];

      let data;

      // ✅ Usar el contador de intentos (NO generatedPNRs.length)
      if (currentAttempt === 0) {
        // ✅ Primera carga: INFANTESILVA/DOMINIK
        data = passengerExamples[0];
      } else if (currentAttempt === 1) {
        // ✅ Segunda carga: INFANTESILVA/DOMINIK nuevamente (para mostrar el modal de duplicado)
        data = passengerExamples[0];
      } else {
        // ✅ Tercera carga en adelante: Aleatorio (excluyendo INFANTESILVA/DOMINIK)
        const availablePassengers = passengerExamples.slice(1); // Excluir el primer elemento (INFANTESILVA/DOMINIK)
        const randomIndex = Math.floor(
          Math.random() * availablePassengers.length,
        );
        data = availablePassengers[randomIndex];
      }

      // ✅ VALIDACIÓN: Verificar si el PNR ya fue generado
      if (generatedPNRs.includes(data.pnr)) {
        setIsScanning(false);
        setDuplicatePNRInfo(data);
        setShowDuplicatePNRModal(true);
        return; // ✅ DETENER el proceso
      }

      //Si el PNR es nuevo, continúar el proceso
      setScannedData(data);
      setPassengerData({ ...passengerData, ...data });
      setIsScanning(false);
    }, 2000);
  };

  const generateRealPDF = (voucherData) => {
    const script1 = document.createElement("script");
    script1.src =
      "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js";
    script1.onload = () => {
      const script2 = document.createElement("script");
      script2.src =
        "https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js";
      script2.onload = () => {
        // NUEVO: Cargar librería de QR Code
        const script3 = document.createElement("script");
        script3.src =
          "https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js";
        script3.onload = () => generatePDFWithLibrary(voucherData);
        document.head.appendChild(script3);
      };
      document.head.appendChild(script2);
    };
    document.head.appendChild(script1);
  };

  const generatePDFWithLibrary = (voucherData) => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const pageWidth = doc.internal.pageSize.width;
    const margin = 15;
    const contentWidth = pageWidth - 2 * margin;

    // HEADER - PLUS ULTRA
    doc.setFontSize(24);
    doc.setFont("helvetica", "bold");
    doc.setTextColor(220, 38, 38);
    doc.text("PLUS ULTRA", margin, 15);
    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    doc.setFont("helvetica", "normal");
    doc.text("LÍNEAS AÉREAS", margin, 21);

    doc.setFontSize(14);
    doc.setFont("helvetica", "bold");
    doc.text("***SERVICE VOUCHER ***", pageWidth / 2, 30, { align: "center" });
    doc.setLineWidth(0.5);
    doc.line(margin, 35, pageWidth - margin, 35);

    let yPos = 43;

    // Información básica
    doc.setFontSize(10);
    doc.setFont("helvetica", "bold");
    doc.text("Numero/Number:", margin, yPos);
    doc.setFont("helvetica", "normal");
    doc.text(voucherData.correlativo, margin + 45, yPos);

    yPos += 7;
    doc.setFont("helvetica", "bold");
    doc.text("Nombre/Name:", margin, yPos);
    doc.setFont("helvetica", "normal");
    doc.text(voucherData.passenger.name || "", margin + 45, yPos);

    yPos += 7;
    doc.setFont("helvetica", "bold");
    doc.text("Vuelo/Flight:", margin, yPos);
    doc.setFont("helvetica", "normal");
    doc.text(
      `${voucherData.flightInfo.flightNumber}/${voucherData.flightInfo.date.replace(/-/g, "").slice(2)}`,
      margin + 45,
      yPos,
    );

    if (voucherData.passenger.pnr) {
      yPos += 7;
      doc.setFont("helvetica", "bold");
      doc.text("PNR:", margin, yPos);
      doc.setFont("helvetica", "normal");
      doc.text(voucherData.passenger.pnr, margin + 45, yPos);
    }

    if (voucherData.flightInfo.notes) {
      yPos += 7;
      doc.setFont("helvetica", "bold");
      doc.text("Notas/Remarks:", margin, yPos);
      doc.setFont("helvetica", "normal");
      const notesText = voucherData.flightInfo.notes.toUpperCase();
      const notesLines = doc.splitTextToSize(notesText, contentWidth - 45);
      doc.text(notesLines, margin + 45, yPos);
      yPos += notesLines.length * 5;
    }

    yPos += 8;
    doc.setFont("helvetica", "bold");
    doc.setFontSize(11);

    if (voucherData.hotel?.name) {
      doc.text(
        `HOTEL: ${voucherData.hotel.name.toUpperCase()}`,
        margin + 3,
        yPos,
      );
      yPos += 8;
    }

    // MOSTRAR HABITACIONES SELECCIONADAS
    if (voucherData.roomSelection) {
      const { simple, doble, matrimonial } = voucherData.roomSelection;
      if (simple > 0 || doble > 0 || matrimonial > 0) {
        doc.setFontSize(10);
        doc.setFont("helvetica", "bold");
        doc.text("HABITACIONES/ROOMS:", margin + 3, yPos);
        yPos += 6;
        doc.setFont("helvetica", "normal");
        doc.setFontSize(9);

        if (simple > 0) {
          doc.text(`${simple} HABITACION(ES) SIMPLE(S)`, margin + 3, yPos);
          yPos += 5;
        }
        if (doble > 0) {
          doc.text(`${doble} HABITACION(ES) DOBLE(S)`, margin + 3, yPos);
          yPos += 5;
        }
        if (matrimonial > 0) {
          doc.text(
            `${matrimonial} HABITACION(ES) MATRIMONIAL(ES)`,
            margin + 3,
            yPos,
          );
          yPos += 5;
        }
        yPos += 3;
      }
    }

    doc.setFontSize(10);
    doc.setFont("helvetica", "bold");
    doc.text("SERVICIOS/SERVICES:", margin + 3, yPos);
    yPos += 6;
    doc.setFont("helvetica", "normal");
    doc.setFontSize(9);

    const servicesList = [];
    if (voucherData.hotelServices) {
      if (voucherData.hotelServices.desayuno) servicesList.push("1DESAYUNO");
      if (voucherData.hotelServices.almuerzo) servicesList.push("1COMIDA");
      if (voucherData.hotelServices.snack) servicesList.push("1SNACK");
      if (voucherData.hotelServices.cena) servicesList.push("1CENA");
    }
    if (voucherData.transport) servicesList.push("1TRANSPORTE");
    if (voucherData.restaurant) servicesList.push("1ALIMENTACION");
    if (servicesList.length === 0 && voucherData.hotel)
      servicesList.push("1ALOJAMIENTO");

    servicesList.forEach((service) => {
      doc.text(service, margin + 3, yPos);
      yPos += 5;
    });

    yPos += 8;
    doc.setFontSize(10);
    doc.setFont("helvetica", "bold");
    doc.text("Emitido/Issued:", margin, yPos);
    doc.setFont("helvetica", "normal");
    doc.text(voucherData.correlativo, margin + 45, yPos);

    yPos += 7;
    doc.setFont("helvetica", "bold");
    doc.text("Fecha/Date:", margin, yPos);
    doc.setFont("helvetica", "normal");
    doc.text(
      voucherData.emissionDate.replace(/-/g, "").slice(2) + " OT",
      margin + 45,
      yPos,
    );

    yPos += 7;
    doc.setFont("helvetica", "bold");
    doc.text("Lugar/Site:", margin, yPos);
    doc.setFont("helvetica", "normal");
    doc.text(voucherData.emissionPlace || "", margin + 45, yPos);

    // Tabla de servicios
    if (voucherData.hotel || voucherData.transport || voucherData.restaurant) {
      yPos += 10;
      doc.setFontSize(11);
      doc.setFont("helvetica", "bold");
      doc.text("DETALLE DE SERVICIOS ASIGNADOS", margin, yPos);

      const tableData = [];

      if (voucherData.hotel?.name) {
        tableData.push([
          "Hotel",
          voucherData.hotel.name,
          voucherData.hotel.address || "",
          voucherData.hotel.phone || "",
        ]);
      }

      if (voucherData.transport?.name) {
        tableData.push([
          "Transporte",
          voucherData.transport.name,
          `${voucherData.transport.type || ""} - ${voucherData.transport.capacity || ""}`,
          voucherData.transport.phone || "",
        ]);
      }

      if (voucherData.restaurant?.name) {
        tableData.push([
          "Alimentación",
          voucherData.restaurant.name,
          `${voucherData.restaurant.cuisine || ""} - ${voucherData.restaurant.address || ""}`,
          voucherData.restaurant.phone || "",
        ]);
      }

      yPos += 3;
      doc.autoTable({
        startY: yPos,
        head: [["Servicio", "Proveedor", "Detalles", "Contacto"]],
        body: tableData,
        theme: "grid",
        headStyles: {
          fillColor: [220, 38, 38],
          textColor: 255,
          fontStyle: "bold",
          fontSize: 9,
          halign: "center",
        },
        styles: {
          fontSize: 8,
          cellPadding: 3,
          lineColor: [0, 0, 0],
          lineWidth: 0.1,
        },
        columnStyles: {
          0: { cellWidth: 25, fontStyle: "bold" },
          1: { cellWidth: 45 },
          2: { cellWidth: 70 },
          3: { cellWidth: 30 },
        },
      });
    }

    // ========================================
    // CÓDIGO QR - VERSIÓN FUNCIONAL
    // ========================================
    yPos = doc.lastAutoTable ? doc.lastAutoTable.finalY + 15 : yPos + 15;

    // Preparar datos del QR en formato legible
    const qrText = `VOUCHER PLUS ULTRA
Correlativo: ${voucherData.correlativo}
Pasajero: ${voucherData.passenger.name}
PNR: ${voucherData.passenger.pnr || "N/A"}
Vuelo: ${voucherData.flightInfo.flightNumber}
Fecha: ${voucherData.flightInfo.date}
Hotel: ${voucherData.hotel?.name || "N/A"}
Transporte: ${voucherData.transport?.name || "N/A"}
Restaurante: ${voucherData.restaurant?.name || "N/A"}
Emisión: ${voucherData.emissionDate} - ${voucherData.emissionPlace}
Email: ${voucherData.passenger.email || "N/A"}
Verificación: PLUSULTRA-${voucherData.correlativo}-${Date.now()}`;

    // Codificar el texto para URL
    const qrDataEncoded = encodeURIComponent(qrText);

    // Generar QR usando API pública (Google Chart API alternativa: api.qrserver.com)
    const qrImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${qrDataEncoded}`;

    // Verificar espacio en la página
    const pageHeight = doc.internal.pageSize.height;
    if (yPos + 55 > pageHeight - 20) {
      doc.addPage();
      yPos = 20;
    }

    // Título del QR
    doc.setFontSize(10);
    doc.setFont("helvetica", "bold");
    doc.setTextColor(0, 0, 0);
    doc.text("CÓDIGO DE VERIFICACIÓN", pageWidth / 2, yPos, {
      align: "center",
    });

    // Cargar imagen del QR desde la API
    const img = new Image();
    img.crossOrigin = "Anonymous";
    img.src = qrImageUrl;

    img.onload = function () {
      // Agregar el QR al PDF
      doc.addImage(
        img,
        "PNG",
        pageWidth / 2 - 20, // Centrado
        yPos + 5,
        40, // Ancho
        40, // Alto
      );

      // Texto explicativo debajo del QR
      doc.setFontSize(8);
      doc.setFont("helvetica", "normal");
      doc.setTextColor(100, 100, 100);
      doc.text(
        "Escanee este código para verificar la autenticidad del voucher",
        pageWidth / 2,
        yPos + 48,
        { align: "center" },
      );

      // Footer
      doc.setFontSize(8);
      doc.setFont("helvetica", "italic");
      doc.setTextColor(100, 100, 100);
      doc.text(
        `AirportHub - Plus Ultra - ${new Date().toLocaleDateString("es-PE")}`,
        pageWidth / 2,
        pageHeight - 10,
        { align: "center" },
      );

      // Guardar el PDF
      doc.save(
        `Voucher_PlusUltra_${voucherData.correlativo || "SIN_CORRELATIVO"}.pdf`,
      );
    };

    img.onerror = function () {
      console.error("Error cargando QR, guardando PDF sin QR");

      // Si falla, guardar sin QR
      doc.setFontSize(8);
      doc.setFont("helvetica", "italic");
      doc.setTextColor(100, 100, 100);
      doc.text(
        `AirportHub - Plus Ultra - ${new Date().toLocaleDateString("es-PE")}`,
        pageWidth / 2,
        pageHeight - 10,
        { align: "center" },
      );

      doc.save(
        `Voucher_PlusUltra_${voucherData.correlativo || "SIN_CORRELATIVO"}.pdf`,
      );
    };
  };

  const exportToExcel = (dataToExport) => {
    const script = document.createElement("script");
    script.src =
      "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js";
    script.onload = () => {
      const XLSX = window.XLSX;
      const excelData = dataToExport.map((voucher, index) => ({
        Posición: index + 1,
        Correlativo: voucher.correlativo,
        PNR: voucher.pdfData?.passenger?.pnr || "",
        "Fecha Creación": new Date(voucher.createdAt).toLocaleString("es-PE"),
        "Fecha Actualización": new Date(voucher.updatedAt).toLocaleString(
          "es-PE",
        ),
        "Generado por": voucher.generatedBy || "N/A",
        "Fecha Emisión": voucher.date,
        Pasajero: voucher.passenger,
        Vuelo: voucher.flight,
        Asiento: voucher.pdfData?.passenger?.seat || "",
        Puerta: voucher.pdfData?.passenger?.gate || "",
        Hotel: voucher.pdfData?.hotel?.name || "N/A",
        Transporte: voucher.pdfData?.transport?.name || "N/A",
        Restaurante: voucher.pdfData?.restaurant?.name || "N/A",
        "Monto Hotel (S/)": voucher.hotelCost > 0 ? voucher.hotelCost.toFixed(2) : "0.00", // 
        "Lugar Emisión": voucher.pdfData?.emissionPlace || "",
        Estado: "Activo",
      }));

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.json_to_sheet(excelData);
      ws["!cols"] = [
        { wch: 10 }, // Posición
        { wch: 20 }, // Correlativo
        { wch: 10 }, // PNR
        { wch: 20 }, // Fecha Creación
        { wch: 20 }, // Fecha Actualización
        { wch: 25 }, // Generado por
        { wch: 30 }, // Pasajero
        { wch: 15 }, // Vuelo
        { wch: 25 }, // Hotel
        { wch: 25 }, // Transporte
        { wch: 25 }, // Restaurante
        { wch: 15 }, // Lugar Emisión
        { wch: 12 }, // Estado
      ];
      XLSX.utils.book_append_sheet(wb, ws, "Vouchers");
      const today = new Date().toISOString().split("T")[0];
      XLSX.writeFile(wb, `Vouchers_PlusUltra_${today}.xlsx`);
    };
    document.head.appendChild(script);
  };

  const handleGeneratePDF = () => {
    if (multiplePassengers.length === 0) {
      alert("Debe agregar al menos un pasajero antes de generar el PDF");
      return;
    }

    setIsGeneratingPDF(true);

    setTimeout(() => {
      const hotelInfo = masterHotels.find(
        (h) => h.id === parseInt(passengerData.selectedHotel),
      );
      const transportInfo = masterTransports.find(
        (t) => t.id === parseInt(passengerData.selectedTransport),
      );
      const restaurantInfo = masterRestaurants.find(
        (r) => r.id === parseInt(passengerData.selectedRestaurant),
      );

      // ✅ Calcular total de habitaciones usadas por todos los pasajeros
      const totalRoomsUsed = multiplePassengers.reduce(
        (acc, passenger) => ({
          simple: acc.simple + (passenger.roomSelection?.simple || 0),
          doble: acc.doble + (passenger.roomSelection?.doble || 0),
          matrimonial:
            acc.matrimonial + (passenger.roomSelection?.matrimonial || 0),
        }),
        { simple: 0, doble: 0, matrimonial: 0 },
      );

      // ✅ Generar PDFs para cada pasajero
      multiplePassengers.forEach((passenger, index) => {
        const correlativo = String(pdfCorrelativo + index).padStart(9, "0");

        // ✅ CALCULAR COSTO PARA ESTE PASAJERO
  const hotelCost = passenger.hotelCost || 0;

        const pdfData = {
          correlativo,
          flightInfo: flightData,
          passenger: {
            name: passenger.name,
            pnr: passenger.pnr,
            email: passenger.email,
            documentNumber: "",
            seat: "",
            gate: "",
          },
          hotel: hotelInfo,
          transport: transportInfo,
          restaurant: restaurantInfo,
          hotelServices: passengerData.hotelServices,
          emissionDate: passengerData.emissionDate,
          emissionPlace: passengerData.emissionPlace,
          roomSelection: passenger.roomSelection,
          hotelCost: hotelCost, // ✅ AGREGAR
        };

        generateRealPDF(pdfData);

        // Registrar voucher
        setRegisteredVouchers((prev) => [
          ...prev,
          {
            id: prev.length + 1,
            correlativo,
            passenger: passenger.name,
            flight: flightData.flightNumber,
            date: new Date().toISOString().split("T")[0],
            pdfData,
            agent: "Usuario Actual",
            // ✅ NUEVOS CAMPOS
            generatedBy: "Juan Pérez Martínez", // Nombre simulado del agente
            createdAt: new Date().toISOString(), // Fecha y hora de creación
            updatedAt: new Date().toISOString(), // Fecha y hora de actualización
             hotelCost: hotelCost, // ✅ AGREGAR
          },
        ]);
      });

      // ✅ Actualizar habitaciones usadas
      if (passengerData.selectedHotel) {
        const hotelId = parseInt(passengerData.selectedHotel);
        const currentUsed = usedRooms[hotelId] || {
          simple: 0,
          doble: 0,
          matrimonial: 0,
        };

        setUsedRooms({
          ...usedRooms,
          [hotelId]: {
            simple: currentUsed.simple + totalRoomsUsed.simple,
            doble: currentUsed.doble + totalRoomsUsed.doble,
            matrimonial: currentUsed.matrimonial + totalRoomsUsed.matrimonial,
          },
        });

        // ✅ Verificar si el hotel se agotó completamente
        const capacity = hotelCapacities[hotelId] || {
          simple: 0,
          doble: 0,
          matrimonial: 0,
        };
        const newUsed = {
          simple: currentUsed.simple + totalRoomsUsed.simple,
          doble: currentUsed.doble + totalRoomsUsed.doble,
          matrimonial: currentUsed.matrimonial + totalRoomsUsed.matrimonial,
        };

        const isFullyBooked =
          newUsed.simple >= capacity.simple &&
          newUsed.doble >= capacity.doble &&
          newUsed.matrimonial >= capacity.matrimonial;

        if (isFullyBooked && !usedResources.hotels.includes(hotelId)) {
          setUsedResources({
            ...usedResources,
            hotels: [...usedResources.hotels, hotelId],
          });
        }
      }

      // Actualizar otros recursos
      const newUsedResources = { ...usedResources };
      if (passengerData.selectedTransport)
        newUsedResources.transports.push(
          parseInt(passengerData.selectedTransport),
        );
      if (passengerData.selectedRestaurant)
        newUsedResources.restaurants.push(
          parseInt(passengerData.selectedRestaurant),
        );
      setUsedResources(newUsedResources);

      // Actualizar correlativo
      setPdfCorrelativo(pdfCorrelativo + multiplePassengers.length);

      // Limpiar todo
      setMultiplePassengers([]);
      setPassengerData({
        name: "",
        documentNumber: "",
        pnr: "",
        seat: "",
        gate: "",
        emissionDate: "",
        emissionPlace: "",
        selectedHotel: "",
        selectedTransport: "",
        selectedRestaurant: "",
        hotelServices: {
          desayuno: false,
          almuerzo: false,
          snack: false,
          cena: false,
        },
        email: "",
        roomSelection: { simple: 0, doble: 0, matrimonial: 0 },
      });

      // ✅ AGREGAR PNRs generados al registro
      const newPNRs = multiplePassengers.map((p) => p.pnr);
      setGeneratedPNRs([...generatedPNRs, ...newPNRs]);

      setIsGeneratingPDF(false);
      setSaveSuccess(true);
      setTimeout(() => setSaveSuccess(false), 3000);
    }, 1500);
  };

  const handleSendEmail = () => {
    if (multiplePassengers.length === 0) {
      alert("Debe agregar al menos un pasajero antes de enviar");
      return;
    }

    const hotelCost = passenger.hotelCost || 0;

    setIsSendingEmail(true);

    setTimeout(() => {
      const hotelInfo = masterHotels.find(
        (h) => h.id === parseInt(passengerData.selectedHotel),
      );
      const transportInfo = masterTransports.find(
        (t) => t.id === parseInt(passengerData.selectedTransport),
      );
      const restaurantInfo = masterRestaurants.find(
        (r) => r.id === parseInt(passengerData.selectedRestaurant),
      );

      // ✅ Calcular total de habitaciones usadas
      const totalRoomsUsed = multiplePassengers.reduce(
        (acc, passenger) => ({
          simple: acc.simple + (passenger.roomSelection?.simple || 0),
          doble: acc.doble + (passenger.roomSelection?.doble || 0),
          matrimonial:
            acc.matrimonial + (passenger.roomSelection?.matrimonial || 0),
        }),
        { simple: 0, doble: 0, matrimonial: 0 },
      );

      // Generar PDFs y registrar vouchers
      multiplePassengers.forEach((passenger, index) => {
        const correlativo = String(pdfCorrelativo + index).padStart(9, "0");

        const pdfData = {
          correlativo,
          flightInfo: flightData,
          passenger: {
            name: passenger.name,
            pnr: passenger.pnr,
            email: passenger.email,
            documentNumber: "",
            seat: "",
            gate: "",
          },
          hotel: hotelInfo,
          transport: transportInfo,
          restaurant: restaurantInfo,
          hotelServices: passengerData.hotelServices,
          emissionDate: passengerData.emissionDate,
          emissionPlace: passengerData.emissionPlace,
          roomSelection: passenger.roomSelection,
            hotelCost: hotelCost, // ✅ AGREGAR
        };

        generateRealPDF(pdfData);

        const recipients = [];
        if (pdfData.hotel) recipients.push(pdfData.hotel.email);
        if (pdfData.transport) recipients.push(pdfData.transport.email);
        if (pdfData.restaurant) recipients.push(pdfData.restaurant.email);
        console.log(`Enviando PDF ${correlativo} a:`, recipients);

        setRegisteredVouchers((prev) => [
          ...prev,
          {
            id: prev.length + 1,
            correlativo,
            passenger: passenger.name,
            flight: flightData.flightNumber,
            date: new Date().toISOString().split("T")[0],
            pdfData,
            agent: "Usuario Actual",
            // ✅ NUEVOS CAMPOS
            generatedBy: "Juan Pérez Martínez", // Nombre simulado del agente
            createdAt: new Date().toISOString(), // Fecha y hora de creación
            updatedAt: new Date().toISOString(), // Fecha y hora de actualización
             hotelCost: hotelCost, // ✅ AGREGAR
          },
        ]);
      });

      // ✅ Actualizar habitaciones usadas
      if (passengerData.selectedHotel) {
        const hotelId = parseInt(passengerData.selectedHotel);
        const currentUsed = usedRooms[hotelId] || {
          simple: 0,
          doble: 0,
          matrimonial: 0,
        };

        setUsedRooms({
          ...usedRooms,
          [hotelId]: {
            simple: currentUsed.simple + totalRoomsUsed.simple,
            doble: currentUsed.doble + totalRoomsUsed.doble,
            matrimonial: currentUsed.matrimonial + totalRoomsUsed.matrimonial,
          },
        });

        // ✅ Verificar si el hotel se agotó completamente
        const capacity = hotelCapacities[hotelId] || {
          simple: 0,
          doble: 0,
          matrimonial: 0,
        };
        const newUsed = {
          simple: currentUsed.simple + totalRoomsUsed.simple,
          doble: currentUsed.doble + totalRoomsUsed.doble,
          matrimonial: currentUsed.matrimonial + totalRoomsUsed.matrimonial,
        };

        const isFullyBooked =
          newUsed.simple >= capacity.simple &&
          newUsed.doble >= capacity.doble &&
          newUsed.matrimonial >= capacity.matrimonial;

        if (isFullyBooked && !usedResources.hotels.includes(hotelId)) {
          setUsedResources({
            ...usedResources,
            hotels: [...usedResources.hotels, hotelId],
          });
        }
      }

      // Actualizar otros recursos
      const newUsedResources = { ...usedResources };
      if (passengerData.selectedTransport)
        newUsedResources.transports.push(
          parseInt(passengerData.selectedTransport),
        );
      if (passengerData.selectedRestaurant)
        newUsedResources.restaurants.push(
          parseInt(passengerData.selectedRestaurant),
        );
      setUsedResources(newUsedResources);

      setPdfCorrelativo(pdfCorrelativo + multiplePassengers.length);

      // Limpiar todo
      setMultiplePassengers([]);
      setPassengerData({
        name: "",
        documentNumber: "",
        pnr: "",
        seat: "",
        gate: "",
        emissionDate: "",
        emissionPlace: "",
        selectedHotel: "",
        selectedTransport: "",
        selectedRestaurant: "",
        hotelServices: {
          desayuno: false,
          almuerzo: false,
          snack: false,
          cena: false,
        },
        email: "",
        roomSelection: { simple: 0, doble: 0, matrimonial: 0 },
      });

      setScannedData(null);

      // ✅ AGREGAR PNRs generados al registro
      const newPNRs = multiplePassengers.map((p) => p.pnr);
      setGeneratedPNRs([...generatedPNRs, ...newPNRs]);

      setIsSendingEmail(false);
      setEmailSent(true);
      setTimeout(() => setEmailSent(false), 3000);
    }, 2500);
  };
  // NUEVO: Función para ver detalle de voucher
  const handleViewVoucherDetail = (voucher) => {
    setSelectedVoucher(voucher);
    setEditedVoucherData({
      ...voucher.pdfData.passenger,
      selectedHotel: voucher.pdfData.hotel?.id || "",
      selectedTransport: voucher.pdfData.transport?.id || "",
      selectedRestaurant: voucher.pdfData.restaurant?.id || "",
      hotelServices: voucher.pdfData.hotelServices || {
        desayuno: false,
        almuerzo: false,
        snack: false,
        cena: false,
      },
      emissionDate: voucher.pdfData.emissionDate || "",
      emissionPlace: voucher.pdfData.emissionPlace || "",
    });
    setIsEditingVoucher(false);
    setCurrentView("voucherDetail");
  };

  // ========================================
// FUNCIÓN PARA CALCULAR COSTO TOTAL DEL HOTEL
// ========================================
const calculateHotelCost = (hotelId, roomSelection) => {
  if (!hotelId || !roomSelection) return 0;
  
  const prices = hotelPrices[hotelId] || { simple: 0, doble: 0, matrimonial: 0 };
  const rooms = roomSelection || { simple: 0, doble: 0, matrimonial: 0 };
  
  const totalCost = 
    (rooms.simple || 0) * (prices.simple || 0) +
    (rooms.doble || 0) * (prices.doble || 0) +
    (rooms.matrimonial || 0) * (prices.matrimonial || 0);
  
  return totalCost;
};

  // NUEVO: Función para guardar cambios del voucher editado
  const handleSaveVoucherChanges = () => {
    setIsSaving(true);
    setTimeout(() => {
      const updatedVouchers = registeredVouchers.map((v) => {
        if (v.id === selectedVoucher.id) {
          const hotelInfo = masterHotels.find(
            (h) => h.id === parseInt(editedVoucherData.selectedHotel),
          );
          const transportInfo = masterTransports.find(
            (t) => t.id === parseInt(editedVoucherData.selectedTransport),
          );
          const restaurantInfo = masterRestaurants.find(
            (r) => r.id === parseInt(editedVoucherData.selectedRestaurant),
          );

          return {
            ...v,
            passenger: editedVoucherData.name,
            updatedAt: new Date().toISOString(), // ✅ ACTUALIZAR FECHA DE ACTUALIZACIÓN
            pdfData: {
              ...v.pdfData,
              passenger: editedVoucherData,
              hotel: hotelInfo,
              transport: transportInfo,
              restaurant: restaurantInfo,
              hotelServices: editedVoucherData.hotelServices,
              emissionDate: editedVoucherData.emissionDate,
              emissionPlace: editedVoucherData.emissionPlace,
            },
          };
        }
        return v;
      });

      setRegisteredVouchers(updatedVouchers);
      const updatedSelectedVoucher = updatedVouchers.find(
        (v) => v.id === selectedVoucher.id,
      );
      setSelectedVoucher(updatedSelectedVoucher);

      setIsSaving(false);
      setSaveSuccess(true);
      setIsEditingVoucher(false);
      setTimeout(() => setSaveSuccess(false), 3000);
    }, 1500);
  };

  // NUEVO: Función para descargar PDF del voucher en detalle
  const handleDownloadVoucherPDF = () => {
    if (selectedVoucher) {
      generateRealPDF(selectedVoucher.pdfData);
    }
  };

  // NUEVO: Función para enviar email del voucher en detalle
  const handleSendVoucherEmail = () => {
    setIsSendingEmail(true);
    setTimeout(() => {
      generateRealPDF(selectedVoucher.pdfData);

      const recipients = [];
      if (selectedVoucher.pdfData.hotel)
        recipients.push(selectedVoucher.pdfData.hotel.email);
      if (selectedVoucher.pdfData.transport)
        recipients.push(selectedVoucher.pdfData.transport.email);
      if (selectedVoucher.pdfData.restaurant)
        recipients.push(selectedVoucher.pdfData.restaurant.email);
      console.log("Enviando PDF a:", recipients);

      setIsSendingEmail(false);
      setEmailSent(true);
      setTimeout(() => setEmailSent(false), 3000);
    }, 2500);
  };

  const handleSaveCompany = () => {
    setIsSaving(true);
    setTimeout(() => {
      if (editingCompanyId) {
        const updateList = (list, setList) => {
          const updated = list.map((item) =>
            item.id === editingCompanyId
              ? {
                  ...item,
                  name: companyData.razonSocial,
                  address: companyData.direccion,
                  phone: companyData.telefono,
                  email: companyData.email,
                }
              : item,
          );
          setList(updated);
        };

        if (companyData.tipoEmpresa === "hospedaje")
          updateList(masterHotels, setMasterHotels);
        else if (companyData.tipoEmpresa === "transporte")
          updateList(masterTransports, setMasterTransports);
        else if (companyData.tipoEmpresa === "alimentacion")
          updateList(masterRestaurants, setMasterRestaurants);

        setRegisteredCompanies(
          registeredCompanies.map((c) =>
            c.id === editingCompanyId ? { ...c, ...companyData } : c,
          ),
        );
        setEditingCompanyId(null);
      } else {
        const newCompany = {
          id: Math.max(...registeredCompanies.map((c) => c.id), 0) + 1,
          ...companyData,
          fechaRegistro: new Date().toISOString().split("T")[0],
          activo: true,
        };
        setRegisteredCompanies([...registeredCompanies, newCompany]);

        const newId =
          companyData.tipoEmpresa === "hospedaje"
            ? Math.max(...masterHotels.map((h) => h.id), 0) + 1
            : companyData.tipoEmpresa === "transporte"
              ? Math.max(...masterTransports.map((t) => t.id), 0) + 1
              : Math.max(...masterRestaurants.map((r) => r.id), 0) + 1;

        const newMasterItem = {
          id: newId,
          name: companyData.razonSocial,
          address: companyData.direccion,
          phone: companyData.telefono,
          email: companyData.email,
          activo: true,
        };

        if (companyData.tipoEmpresa === "hospedaje")
          setMasterHotels([...masterHotels, newMasterItem]);
        else if (companyData.tipoEmpresa === "transporte")
          setMasterTransports([
            ...masterTransports,
            { ...newMasterItem, type: "Bus", capacity: "45 pasajeros" },
          ]);
        else if (companyData.tipoEmpresa === "alimentacion")
          setMasterRestaurants([
            ...masterRestaurants,
            { ...newMasterItem, cuisine: "Variada" },
          ]);
      }

      setIsSaving(false);
      setSaveSuccess(true);
      setTimeout(() => {
        setSaveSuccess(false);
        setCompanyData({
          razonSocial: "",
          ruc: "",
          direccion: "",
          tipoEmpresa: "",
          telefono: "",
          email: "",
        });
      }, 3000);
    }, 1500);
  };

  const handlePasswordRecovery = () => {
    setRecoverySuccess(true);
    setTimeout(() => {
      setRecoverySuccess(false);
      setRecoveryEmail("");
      setCurrentView("login");
    }, 3000);
  };

  const handlePasswordChange = () => {
    if (newPassword === confirmPassword && newPassword.length >= 6) {
      alert("Contraseña cambiada exitosamente");
      setNewPassword("");
      setConfirmPassword("");
      setCurrentView("login");
    } else {
      alert(
        "Las contraseñas no coinciden o son muy cortas (mínimo 6 caracteres)",
      );
    }
  };

  const handleReturnToRoleSelect = () => {
    setUserRole(null);
    setCurrentView("roleSelect");
  };

  // const handleSaveFlightData = () => {
  //   setIsSaving(true);
  //   setTimeout(() => {
  //     setIsSaving(false);
  //     setSaveSuccess(true);
  //     setTimeout(() => setSaveSuccess(false), 3000);
  //   }, 1500);
  // };

  // NUEVA FUNCIÓN: Guardar Información de Vuelo + Recursos habilitados
  const handleSaveAllData = () => {
    // Validar que el vuelo tenga información básica
    if (!flightData.flightNumber || !flightData.date || !flightData.time) {
      alert(
        "Por favor complete la información del vuelo (Número, Fecha y Hora)",
      );
      return;
    }

    setIsSaving(true);
    setTimeout(() => {
      // Aquí se guardaría la información del vuelo y los recursos
      // En una implementación real, esto haría llamadas a la API

      setIsSaving(false);
      setSaveSuccess(true);
      setTimeout(() => setSaveSuccess(false), 3000);
    }, 1500);
  };

  const getTipoEmpresaColor = (tipo) =>
    ({ transporte: "blue", hospedaje: "purple", alimentacion: "orange" })[
      tipo
    ] || "gray";
  const getTipoEmpresaLabel = (tipo) =>
    ({
      transporte: "Transporte",
      hospedaje: "Hospedaje",
      alimentacion: "Alimentación",
    })[tipo] || tipo;
  const getTipoEmpresaIcon = (tipo) => {
    if (tipo === "transporte") return <Truck className="w-6 h-6" />;
    if (tipo === "hospedaje") return <Hotel className="w-6 h-6" />;
    if (tipo === "alimentacion") return <Utensils className="w-6 h-6" />;
    return <Building className="w-6 h-6" />;
  };

  const clearFilters = () => {
    setFilters({
      correlativo: "",
      passenger: "",
      flight: "",
      hotel: "",
      transport: "",
      restaurant: "",
      pnr: "",
      dateFrom: "",
      dateTo: "",
      agent: "",
    });
  };

  // NUEVO: Recursos disponibles para el AGENTE (solo los habilitados por el líder y no usados)
  const getAvailableHotelsForAgent = () => {
    return masterHotels.filter(
      (hotel) =>
        hotel.activo &&
        enabledResources.hotels.includes(hotel.id) &&
        !usedResources.hotels.includes(hotel.id),
    );
  };

  const getAvailableTransportsForAgent = () => {
    return masterTransports.filter(
      (transport) =>
        transport.activo &&
        enabledResources.transports.includes(transport.id) &&
        !usedResources.transports.includes(transport.id),
    );
  };

  const getAvailableRestaurantsForAgent = () => {
    return masterRestaurants.filter(
      (restaurant) =>
        restaurant.activo &&
        enabledResources.restaurants.includes(restaurant.id) &&
        !usedResources.restaurants.includes(restaurant.id),
    );
  };

  const toggleTransportSelection = (transportId) => {
    const newTransports = enabledResources.transports.includes(transportId)
      ? enabledResources.transports.filter((id) => id !== transportId)
      : [...enabledResources.transports, transportId];
    setEnabledResources({ ...enabledResources, transports: newTransports });
  };

  const toggleRestaurantSelection = (restaurantId) => {
    const newRestaurants = enabledResources.restaurants.includes(restaurantId)
      ? enabledResources.restaurants.filter((id) => id !== restaurantId)
      : [...enabledResources.restaurants, restaurantId];
    setEnabledResources({ ...enabledResources, restaurants: newRestaurants });
  };

  // PANTALLAS DE LOGIN, RECOVERY Y CHANGE PASSWORD
  if (currentView === "recovery") {
    return (
      <div
        className="min-h-screen flex items-center justify-center p-4 relative bg-cover bg-center bg-no-repeat"
        style={{
          backgroundImage: `url('https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=2074&auto=format&fit=crop')`,
        }}
      >
        <div className="absolute inset-0 bg-gradient-to-br from-blue-900/90 via-indigo-900/85 to-purple-900/90 backdrop-blur-sm"></div>
        <div className="w-full max-w-md relative z-10">
          <button
            onClick={() => setCurrentView("login")}
            className="flex items-center gap-2 text-white/90 hover:text-white mb-6 transition bg-white/10 hover:bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg border border-white/30"
          >
            <ArrowLeft size={20} /> Volver al inicio
          </button>
          <div className="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl p-8 border border-white/50">
            <div className="text-center mb-8">
              <div className="bg-gradient-to-br from-blue-500 to-indigo-600 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl border-4 border-white/50">
                <Mail className="w-10 h-10 text-white" />
              </div>
              <h2 className="text-3xl font-bold text-slate-800 mb-2">
                Recuperar Contraseña
              </h2>
              <p className="text-slate-600">
                Ingresa tu correo electrónico y te enviaremos instrucciones
              </p>
            </div>
            {!recoverySuccess ? (
              <div className="space-y-6">
                <div>
                  <label className="block text-sm font-medium text-slate-700 mb-2">
                    Correo Electrónico
                  </label>
                  <div className="relative">
                    <Mail
                      className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
                      size={20}
                    />
                    <input
                      type="email"
                      value={recoveryEmail}
                      onChange={(e) => setRecoveryEmail(e.target.value)}
                      placeholder="usuario@ejemplo.com"
                      className="w-full pl-12 pr-4 py-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                    />
                  </div>
                </div>
                <button
                  onClick={handlePasswordRecovery}
                  disabled={!recoveryEmail}
                  className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 disabled:from-gray-400 disabled:to-gray-400 text-white font-semibold py-3 rounded-lg transition shadow-lg hover:shadow-xl"
                >
                  Enviar Instrucciones
                </button>
              </div>
            ) : (
              <div className="bg-green-50 border-2 border-green-200 rounded-lg p-6">
                <div className="flex items-center gap-3 mb-3">
                  <div className="bg-green-500 rounded-full p-2">
                    <Check className="text-white" size={24} />
                  </div>
                  <p className="text-green-800 font-semibold text-lg">
                    ¡Correo enviado exitosamente!
                  </p>
                </div>
                <p className="text-green-700">
                  Revisa tu correo electrónico para restablecer tu contraseña.
                </p>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }

  if (currentView === "changePassword") {
    return (
      <div
        className="min-h-screen flex items-center justify-center p-4 relative bg-cover bg-center bg-no-repeat"
        style={{
          backgroundImage: `url('https://images.unsplash.com/photo-1464037866556-6812c9d1c72e?q=80&w=2070&auto=format&fit=crop')`,
        }}
      >
        <div className="absolute inset-0 bg-gradient-to-br from-purple-900/90 via-pink-900/85 to-rose-900/90 backdrop-blur-sm"></div>
        <div className="w-full max-w-md relative z-10">
          <button
            onClick={() => setCurrentView("login")}
            className="flex items-center gap-2 text-white/90 hover:text-white mb-6 transition bg-white/10 hover:bg-white/20 backdrop-blur-sm px-4 py-2 rounded-lg border border-white/30"
          >
            <ArrowLeft size={20} /> Volver al inicio
          </button>
          <div className="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl p-8 border border-white/50">
            <div className="text-center mb-8">
              <div className="bg-gradient-to-br from-purple-500 to-pink-600 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl border-4 border-white/50">
                <Shield className="w-10 h-10 text-white" />
              </div>
              <h2 className="text-3xl font-bold text-slate-800 mb-2">
                Cambiar Contraseña
              </h2>
              <p className="text-slate-600">
                Ingresa tu nueva contraseña segura
              </p>
            </div>
            <div className="space-y-6">
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-2">
                  Nueva Contraseña
                </label>
                <div className="relative">
                  <Lock
                    className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
                    size={20}
                  />
                  <input
                    type={showNewPassword ? "text" : "password"}
                    value={newPassword}
                    onChange={(e) => setNewPassword(e.target.value)}
                    placeholder="••••••••"
                    className="w-full pl-12 pr-12 py-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition"
                  />
                  <button
                    onClick={() => setShowNewPassword(!showNewPassword)}
                    className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition"
                  >
                    {showNewPassword ? <EyeOff size={20} /> : <Eye size={20} />}
                  </button>
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium text-slate-700 mb-2">
                  Confirmar Contraseña
                </label>
                <div className="relative">
                  <Lock
                    className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
                    size={20}
                  />
                  <input
                    type={showConfirmPassword ? "text" : "password"}
                    value={confirmPassword}
                    onChange={(e) => setConfirmPassword(e.target.value)}
                    placeholder="••••••••"
                    className="w-full pl-12 pr-12 py-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition"
                  />
                  <button
                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                    className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition"
                  >
                    {showConfirmPassword ? (
                      <EyeOff size={20} />
                    ) : (
                      <Eye size={20} />
                    )}
                  </button>
                </div>
              </div>
              <button
                onClick={handlePasswordChange}
                disabled={!newPassword || !confirmPassword}
                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-400 disabled:to-gray-400 text-white font-semibold py-3 rounded-lg transition shadow-lg hover:shadow-xl"
              >
                Cambiar Contraseña
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (currentView === "login") {
    return (
      <div className="min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
        {/* Imagen de fondo con avión */}
        <div
          className="absolute inset-0 bg-cover bg-center bg-no-repeat"
          style={{
            backgroundImage: `url('https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=2074&auto=format&fit=crop')`,
          }}
        ></div>

        {/* Overlay con gradiente */}
        <div className="absolute inset-0 bg-gradient-to-br from-indigo-900/95 via-purple-900/90 to-pink-900/95 backdrop-blur-sm"></div>

        {/* Efectos de fondo decorativos */}
        <div className="absolute inset-0 opacity-20">
          <div className="absolute top-0 -left-4 w-72 h-72 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl animate-blob"></div>
          <div className="absolute top-0 -right-4 w-72 h-72 bg-yellow-300 rounded-full mix-blend-multiply filter blur-xl animate-blob animation-delay-2000"></div>
          <div className="absolute -bottom-8 left-20 w-72 h-72 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl animate-blob animation-delay-4000"></div>
        </div>

        <div className="w-full max-w-6xl relative z-10 flex bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-white/20">
          {/* Panel izquierdo - Información */}
          <div className="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-indigo-600/90 via-purple-600/90 to-pink-500/90 p-12 flex-col justify-between relative overflow-hidden">
            {/* Patrón de fondo */}
            <div className="absolute inset-0 opacity-10">
              <div className="absolute top-10 left-10 w-20 h-20 border-4 border-white rounded-full"></div>
              <div className="absolute bottom-20 right-10 w-32 h-32 border-4 border-white rounded-lg transform rotate-45"></div>
              <div className="absolute top-1/2 left-1/4 w-16 h-16 bg-white rounded-full"></div>
            </div>

            <div className="relative z-10">
              <div className="flex items-center gap-4 mb-8">
                <div className="bg-white/20 backdrop-blur-sm p-4 rounded-2xl border-2 border-white/40 shadow-lg">
                  <Plane className="w-12 h-12 text-white" />
                </div>
                <div>
                  <h1 className="text-4xl font-bold text-white drop-shadow-lg">
                    AirportHub
                  </h1>
                  <p className="text-white/90 text-lg drop-shadow">
                    Plus Ultra Airlines
                  </p>
                </div>
              </div>

              <div className="space-y-4">
                <h2 className="text-4xl font-bold text-white leading-tight drop-shadow-lg">
                  Gestión de Contingencia
                </h2>
                <p className="text-white/90 text-lg leading-relaxed drop-shadow">
                  Sistema integral de gestión de servicios para pasajeros Plus
                  Ultra
                </p>

                <div className="pt-6 space-y-3">
                  <div className="flex items-center gap-3 text-white/90">
                    <div className="w-2 h-2 bg-white rounded-full shadow-lg"></div>
                    <span className="drop-shadow">
                      Gestión eficiente de recursos
                    </span>
                  </div>
                  <div className="flex items-center gap-3 text-white/90">
                    <div className="w-2 h-2 bg-white rounded-full shadow-lg"></div>
                    <span className="drop-shadow">Control en tiempo real</span>
                  </div>
                  <div className="flex items-center gap-3 text-white/90">
                    <div className="w-2 h-2 bg-white rounded-full shadow-lg"></div>
                    <span className="drop-shadow">
                      Interfaz moderna e intuitiva
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <p className="text-white/80 text-sm drop-shadow relative z-10">
              © 2026 AirportHub - Plus Ultra Airlines
            </p>
          </div>

          {/* Panel derecho - Formulario */}
          <div className="w-full lg:w-1/2 p-12 flex flex-col justify-center bg-white">
            {/* Logo móvil */}
            <div className="lg:hidden flex items-center justify-center gap-3 mb-8">
              <div className="bg-gradient-to-br from-indigo-600 to-purple-600 p-3 rounded-xl shadow-lg">
                <Plane className="w-8 h-8 text-white" />
              </div>
              <div>
                <h1 className="text-xl sm:text-2xl font-bold text-slate-800">
                  AirportHub
                </h1>
                <p className="text-sm text-slate-600">Plus Ultra</p>
              </div>
            </div>

            <div className="text-center mb-8">
              <h2 className="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-3">
                Bienvenido
              </h2>
              <p className="text-slate-600 text-lg">
                Inicia sesión para continuar
              </p>
            </div>

            <div className="space-y-6">
              {/* Campo Usuario */}
              <div>
                <label className="block text-sm font-semibold text-slate-700 mb-2">
                  Usuario
                </label>
                <div className="relative group">
                  <User
                    className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-600 transition-colors"
                    size={20}
                  />
                  <input
                    type="text"
                    placeholder="Ingrese su usuario"
                    className="w-full pl-12 pr-4 py-3.5 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all hover:border-slate-300"
                  />
                </div>
              </div>

              {/* Campo Contraseña */}
              <div>
                <label className="block text-sm font-semibold text-slate-700 mb-2">
                  Contraseña
                </label>
                <div className="relative group">
                  <Lock
                    className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-600 transition-colors"
                    size={20}
                  />
                  <input
                    type={showPassword ? "text" : "password"}
                    placeholder="••••••••"
                    className="w-full pl-12 pr-12 py-3.5 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all hover:border-slate-300"
                  />
                  <button
                    onClick={() => setShowPassword(!showPassword)}
                    className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors"
                  >
                    {showPassword ? <EyeOff size={20} /> : <Eye size={20} />}
                  </button>
                </div>
              </div>

              {/* Enlaces de recuperación */}
              <div className="flex items-center justify-between text-sm">
                <button
                  onClick={() => setCurrentView("recovery")}
                  className="text-indigo-600 hover:text-indigo-700 font-semibold transition-colors hover:underline flex items-center gap-1 group"
                >
                  <Mail
                    size={16}
                    className="group-hover:scale-110 transition-transform"
                  />
                  ¿Olvidaste tu contraseña?
                </button>
                <button
                  onClick={() => setCurrentView("changePassword")}
                  className="text-purple-600 hover:text-purple-700 font-semibold transition-colors hover:underline flex items-center gap-1 group"
                >
                  <Shield
                    size={16}
                    className="group-hover:scale-110 transition-transform"
                  />
                  Cambiar contraseña
                </button>
              </div>

              {/* Botón de ingreso */}
              <button
                onClick={() => setCurrentView("roleSelect")}
                className="w-full bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 hover:from-indigo-700 hover:via-purple-700 hover:to-pink-600 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 active:translate-y-0"
              >
                Ingresar al Sistema
              </button>

              {/* Divider */}
              <div className="relative">
                <div className="absolute inset-0 flex items-center">
                  <div className="w-full border-t border-slate-200"></div>
                </div>
                <div className="relative flex justify-center text-sm">
                  <span className="px-4 bg-white text-slate-500">
                    Sistema seguro y confiable
                  </span>
                </div>
              </div>

              {/* Info adicional */}
              <div className="text-center text-sm text-slate-600">
                <p>¿Necesitas ayuda? Contacta al administrador</p>
              </div>
            </div>
          </div>
        </div>

        {/* Estilos para animaciones */}
        <style>{`
          @keyframes blob {
            0% {
              transform: translate(0px, 0px) scale(1);
            }
            33% {
              transform: translate(30px, -50px) scale(1.1);
            }
            66% {
              transform: translate(-20px, 20px) scale(0.9);
            }
            100% {
              transform: translate(0px, 0px) scale(1);
            }
          }
          .animate-blob {
            animation: blob 7s infinite;
          }
          .animation-delay-2000 {
            animation-delay: 2s;
          }
          .animation-delay-4000 {
            animation-delay: 4s;
          }
        `}</style>
      </div>
    );
  }

  if (currentView === "roleSelect") {
    return (
      <div
        className="min-h-screen flex items-center justify-center p-4 relative bg-cover bg-center bg-no-repeat"
        style={{
          backgroundImage: `url('https://images.unsplash.com/photo-1556388158-158ea5ccacbd?q=80&w=2070&auto=format&fit=crop')`,
        }}
      >
        <div className="absolute inset-0 bg-gradient-to-br from-slate-900/85 via-red-900/80 to-slate-900/85 backdrop-blur-sm"></div>
        <div className="w-full max-w-5xl relative z-10">
          <div className="text-center mb-12">
            <div className="bg-white/10 backdrop-blur-md w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 border-4 border-white/30 shadow-2xl">
              <Plane className="w-14 h-14 text-white" />
            </div>
            <h2 className="text-4xl font-bold text-white mb-3 drop-shadow-2xl">
              Gestión Aeropuertuario
            </h2>
            <p className="text-white/90 text-lg drop-shadow-lg">
              Plus Ultra Airlines - Sistema de Gestión
            </p>
          </div>
          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {[
              {
                role: "airportLeader",
                color: "red",
                icon: Plane,
                title: "Líder SAASA",
                desc: "Habilita recursos del día",
              },
              {
                role: "agent",
                color: "green",
                icon: Users,
                title: "Agente SAASA",
                desc: "Registra pasajeros y servicios",
              },
              {
                role: "airline",
                color: "purple",
                icon: Building2,
                title: "Línea Aérea",
                desc: "Visualiza y exporta",
              },
              {
                role: "admin",
                color: "orange",
                icon: Building,
                title: "Administrador",
                desc: "Gestiona proveedores y usuarios",
              },
            ].map(({ role, color, icon: Icon, title, desc }) => (
              <div
                key={role}
                onClick={() => {
                  setUserRole(role);
                  setCurrentView("dashboard");
                }}
                className="bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl p-8 cursor-pointer hover:shadow-[0_20px_60px_rgba(255,255,255,0.4)] hover:scale-105 hover:bg-white transition-all border-2 border-white/50 hover:border-white"
              >
                <div
                  className={`bg-${color}-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg`}
                >
                  <Icon className={`w-8 h-8 text-${color}-600`} />
                </div>
                <h3 className="text-xl font-bold text-slate-800 text-center mb-2">
                  {title}
                </h3>
                <p className="text-slate-600 text-center text-sm">{desc}</p>
              </div>
            ))}
          </div>
          <div className="text-center mt-8">
            <button
              onClick={() => setCurrentView("login")}
              className="text-white hover:text-white/80 font-medium transition flex items-center gap-2 mx-auto bg-white/10 hover:bg-white/20 backdrop-blur-sm px-6 py-3 rounded-lg border border-white/30"
            >
              <ArrowLeft size={20} /> Volver al inicio de sesión
            </button>
          </div>
        </div>
      </div>
    );
  }

  // DASHBOARD PRINCIPAL

  // NUEVA VISTA: Detalle del Voucher
  // NUEVA VISTA: Detalle del Voucher - VERSIÓN MOBILE OPTIMIZADA
  if (currentView === "voucherDetail" && selectedVoucher) {
    return (
      <div className="min-h-screen bg-slate-100">
        {/* Header */}
        <div className="bg-purple-600 text-white p-4 shadow-lg">
          <div className="flex items-center justify-between max-w-7xl mx-auto">
            <div className="flex-1 min-w-0">
              <h1 className="text-lg sm:text-xl md:text-2xl font-bold truncate">
                Información General - Ticket #{selectedVoucher.id}
              </h1>
              <p className="text-xs sm:text-sm opacity-90">
                Plus Ultra Airlines
              </p>
            </div>
            <button
              onClick={() => {
                setCurrentView("dashboard");
                setSelectedVoucher(null);
                setIsEditingVoucher(false);
              }}
              className="flex items-center gap-2 bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg transition ml-2 flex-shrink-0"
            >
              <ArrowLeft size={18} className="sm:w-5 sm:h-5" />
              <span className="hidden sm:inline text-sm">Volver</span>
            </button>
          </div>
        </div>

        {/* Content */}
        <div className="max-w-7xl mx-auto p-3 sm:p-4 md:p-6">
          <div className="bg-white rounded-xl shadow-lg p-4 sm:p-6 md:p-8">
            {/* Info de cabecera */}
            <div className="flex flex-col gap-4 mb-6 pb-6 border-b border-slate-200">
              <div>
                <h2 className="text-xl sm:text-2xl font-bold text-slate-800 mb-3">
                  Información general - Ticket #{selectedVoucher.id}
                </h2>
                {/* Información del generador */}
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 inline-block">
                  <p className="text-xs sm:text-sm text-blue-800">
                    <span className="font-semibold">Generado por:</span>{" "}
                    {selectedVoucher.generatedBy}
                  </p>
                </div>
              </div>

              {/* Fechas e información */}
              {/* Fechas e información - TODO EN LÍNEA HORIZONTAL */}
              <div className="space-y-2 text-xs sm:text-sm">
                <div className="flex items-center gap-2">
                  <span className="font-semibold text-slate-700 whitespace-nowrap">
                    Fecha de creación:
                  </span>
                  <span className="text-slate-600">
                    {new Date(selectedVoucher.createdAt).toLocaleString(
                      "es-PE",
                      {
                        year: "numeric",
                        month: "2-digit",
                        day: "2-digit",
                        hour: "2-digit",
                        minute: "2-digit",
                        second: "2-digit",
                      },
                    )}
                  </span>
                </div>

                <div className="flex items-center gap-2">
                  <span className="font-semibold text-slate-700 whitespace-nowrap">
                    Fecha de actualización:
                  </span>
                  <span className="text-slate-600">
                    {new Date(selectedVoucher.updatedAt).toLocaleString(
                      "es-PE",
                      {
                        year: "numeric",
                        month: "2-digit",
                        day: "2-digit",
                        hour: "2-digit",
                        minute: "2-digit",
                        second: "2-digit",
                      },
                    )}
                  </span>
                </div>

                <div className="flex items-center gap-2">
                  <span className="font-semibold text-slate-700 whitespace-nowrap">
                    Código requerimiento:
                  </span>
                  <span className="text-slate-600 font-mono">
                    {selectedVoucher.correlativo}
                  </span>
                </div>

                <div className="flex items-center gap-2">
                  <span className="font-semibold text-slate-700 whitespace-nowrap">
                    Estado:
                  </span>
                  <span className="px-3 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">
                    En Ejecución
                  </span>
                </div>
              </div>
            </div>

            {/* Formulario */}
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6">
              {/* Nombre comercial */}
              <div className="sm:col-span-2 lg:col-span-1">
                <label className="block text-xs sm:text-sm font-medium text-slate-700 mb-2">
                  Nombre comercial (Empresa)
                </label>
                <input
                  type="text"
                  value={selectedVoucher.pdfData.flightInfo.airline}
                  disabled
                  className="w-full px-3 sm:px-4 py-2 sm:py-3 bg-slate-100 border border-slate-300 rounded-lg text-slate-700 font-medium text-sm sm:text-base"
                />
              </div>

              {/* Cliente (Contacto) */}
              <div className="sm:col-span-2 lg:col-span-1">
                <label className="block text-xs sm:text-sm font-medium text-slate-700 mb-2">
                  Pasajero
                </label>
                <input
                  type="text"
                  value={
                    isEditingVoucher
                      ? editedVoucherData.name
                      : selectedVoucher.passenger
                  }
                  onChange={(e) =>
                    isEditingVoucher &&
                    setEditedVoucherData({
                      ...editedVoucherData,
                      name: e.target.value,
                    })
                  }
                  disabled={!isEditingVoucher}
                  className={`w-full px-3 sm:px-4 py-2 sm:py-3 border border-slate-300 rounded-lg text-sm sm:text-base ${
                    isEditingVoucher
                      ? "bg-white"
                      : "bg-slate-100 text-slate-700 font-medium"
                  }`}
                />
              </div>

              {/* Correo electrónico */}
              <div className="sm:col-span-2 lg:col-span-1">
                <label className="block text-xs sm:text-sm font-medium text-slate-700 mb-2">
                  Correo electrónico
                </label>
                <input
                  type="text"
                  value="INFANTE@GMAIL.COM"
                  disabled
                  className="w-full px-3 sm:px-4 py-2 sm:py-3 bg-slate-100 border border-slate-300 rounded-lg text-slate-700 font-medium text-sm sm:text-base"
                />
              </div>

              {/* PNR */}
              <div>
                <label className="block text-xs sm:text-sm font-medium text-slate-700 mb-2">
                  PNR
                </label>
                <input
                  type="text"
                  value={
                    isEditingVoucher
                      ? editedVoucherData.pnr
                      : selectedVoucher.pdfData.passenger.pnr || "N/A"
                  }
                  onChange={(e) =>
                    isEditingVoucher &&
                    setEditedVoucherData({
                      ...editedVoucherData,
                      pnr: e.target.value,
                    })
                  }
                  disabled={!isEditingVoucher}
                  className={`w-full px-3 sm:px-4 py-2 sm:py-3 border border-slate-300 rounded-lg text-sm sm:text-base ${
                    isEditingVoucher
                      ? "bg-white"
                      : "bg-slate-100 text-slate-700 font-medium"
                  }`}
                />
              </div>

              {/* Hotel */}
              <div>
                <label className="block text-xs sm:text-sm font-medium text-slate-700 mb-2">
                  Hotel
                </label>
                {isEditingVoucher ? (
                  <select
                    value={editedVoucherData.selectedHotel}
                    onChange={(e) =>
                      setEditedVoucherData({
                        ...editedVoucherData,
                        selectedHotel: e.target.value,
                      })
                    }
                    className="w-full px-3 sm:px-4 py-2 sm:py-3 border border-slate-300 rounded-lg bg-white text-sm sm:text-base"
                  >
                    <option value="">Seleccionar hotel...</option>
                    {masterHotels
                      .filter((h) => h.activo)
                      .map((hotel) => (
                        <option key={hotel.id} value={hotel.id}>
                          {hotel.name}
                        </option>
                      ))}
                  </select>
                ) : (
                  <input
                    type="text"
                    value={selectedVoucher.pdfData.hotel?.name || "N/A"}
                    disabled
                    className="w-full px-3 sm:px-4 py-2 sm:py-3 bg-slate-100 border border-slate-300 rounded-lg text-slate-700 font-medium text-sm sm:text-base"
                  />
                )}
              </div>

              {/* Transporte */}
              <div>
                <label className="block text-xs sm:text-sm font-medium text-slate-700 mb-2">
                  Transporte
                </label>
                {isEditingVoucher ? (
                  <select
                    value={editedVoucherData.selectedTransport}
                    onChange={(e) =>
                      setEditedVoucherData({
                        ...editedVoucherData,
                        selectedTransport: e.target.value,
                      })
                    }
                    className="w-full px-3 sm:px-4 py-2 sm:py-3 border border-slate-300 rounded-lg bg-white text-sm sm:text-base"
                  >
                    <option value="">Seleccionar transporte...</option>
                    {masterTransports
                      .filter((t) => t.activo)
                      .map((transport) => (
                        <option key={transport.id} value={transport.id}>
                          {transport.name}
                        </option>
                      ))}
                  </select>
                ) : (
                  <input
                    type="text"
                    value={selectedVoucher.pdfData.transport?.name || "N/A"}
                    disabled
                    className="w-full px-3 sm:px-4 py-2 sm:py-3 bg-slate-100 border border-slate-300 rounded-lg text-slate-700 font-medium text-sm sm:text-base"
                  />
                )}
              </div>

              {/* Restaurante */}
              <div>
                <label className="block text-xs sm:text-sm font-medium text-slate-700 mb-2">
                  Restaurante
                </label>
                {isEditingVoucher ? (
                  <select
                    value={editedVoucherData.selectedRestaurant}
                    onChange={(e) =>
                      setEditedVoucherData({
                        ...editedVoucherData,
                        selectedRestaurant: e.target.value,
                      })
                    }
                    className="w-full px-3 sm:px-4 py-2 sm:py-3 border border-slate-300 rounded-lg bg-white text-sm sm:text-base"
                  >
                    <option value="">Seleccionar restaurante...</option>
                    {masterRestaurants
                      .filter((r) => r.activo)
                      .map((restaurant) => (
                        <option key={restaurant.id} value={restaurant.id}>
                          {restaurant.name}
                        </option>
                      ))}
                  </select>
                ) : (
                  <input
                    type="text"
                    value={selectedVoucher.pdfData.restaurant?.name || "N/A"}
                    disabled
                    className="w-full px-3 sm:px-4 py-2 sm:py-3 bg-slate-100 border border-slate-300 rounded-lg text-slate-700 font-medium text-sm sm:text-base"
                  />
                )}
              </div>

              {/* Lugar de Emisión */}
              <div className="sm:col-span-2 lg:col-span-3">
                <label className="block text-xs sm:text-sm font-medium text-slate-700 mb-2">
                  Lugar de Emisión
                </label>
                <input
                  type="text"
                  value={
                    isEditingVoucher
                      ? editedVoucherData.emissionPlace
                      : selectedVoucher.pdfData.emissionPlace || "N/A"
                  }
                  onChange={(e) =>
                    isEditingVoucher &&
                    setEditedVoucherData({
                      ...editedVoucherData,
                      emissionPlace: e.target.value,
                    })
                  }
                  disabled={!isEditingVoucher}
                  className={`w-full px-3 sm:px-4 py-2 sm:py-3 border border-slate-300 rounded-lg text-sm sm:text-base ${
                    isEditingVoucher
                      ? "bg-white"
                      : "bg-slate-100 text-slate-700 font-medium"
                  }`}
                />
              </div>
            </div>

            {/* Servicios del hotel (si está en modo edición) */}
            {isEditingVoucher && editedVoucherData.selectedHotel && (
              <div className="mb-6 p-3 sm:p-4 bg-slate-50 rounded-lg border border-slate-200">
                <h3 className="text-sm font-semibold text-slate-700 mb-3">
                  Servicios del Hotel
                </h3>
                <div className="grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3">
                  {[
                    { key: "desayuno", label: "Desayuno" },
                    { key: "almuerzo", label: "Almuerzo" },
                    { key: "snack", label: "Snack" },
                    { key: "cena", label: "Cena" },
                  ].map(({ key, label }) => (
                    <button
                      key={key}
                      onClick={() =>
                        setEditedVoucherData({
                          ...editedVoucherData,
                          hotelServices: {
                            ...editedVoucherData.hotelServices,
                            [key]: !editedVoucherData.hotelServices[key],
                          },
                        })
                      }
                      className="flex items-center gap-2 p-2 sm:p-3 border-2 border-slate-300 rounded-lg hover:border-purple-500 hover:bg-white transition"
                    >
                      {editedVoucherData.hotelServices[key] ? (
                        <CheckSquare className="w-4 h-4 sm:w-5 sm:h-5 text-purple-600 flex-shrink-0" />
                      ) : (
                        <Square className="w-4 h-4 sm:w-5 sm:h-5 text-slate-400 flex-shrink-0" />
                      )}
                      <span className="text-xs sm:text-sm font-medium text-slate-700">
                        {label}
                      </span>
                    </button>
                  ))}
                </div>
              </div>
            )}

            {/* Botones de acción */}
            <div className="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-6 border-t border-slate-200">
              {!isEditingVoucher ? (
                <>
                  <button
                    onClick={() => setIsEditingVoucher(true)}
                    className="flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 sm:px-6 py-3 rounded-lg transition font-semibold text-sm sm:text-base w-full sm:w-auto"
                  >
                    <Edit size={18} className="sm:w-5 sm:h-5" />
                    Editar
                  </button>
                  <button
                    onClick={handleDownloadVoucherPDF}
                    disabled={isGeneratingPDF}
                    className="flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 sm:px-6 py-3 rounded-lg transition font-semibold text-sm sm:text-base w-full sm:w-auto"
                  >
                    {isGeneratingPDF ? (
                      <>
                        <Loader2 className="animate-spin w-4 h-4 sm:w-5 sm:h-5" />
                        <span className="hidden sm:inline">Generando...</span>
                        <span className="sm:hidden">Generando...</span>
                      </>
                    ) : (
                      <>
                        <Download size={18} className="sm:w-5 sm:h-5" />
                        <span className="hidden sm:inline">Descargar PDF</span>
                        <span className="sm:hidden">PDF</span>
                      </>
                    )}
                  </button>
                  <button
                    onClick={handleSendVoucherEmail}
                    disabled={isSendingEmail}
                    className="flex items-center justify-center gap-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white px-4 sm:px-6 py-3 rounded-lg transition font-semibold text-sm sm:text-base w-full sm:w-auto"
                  >
                    {isSendingEmail ? (
                      <>
                        <Loader2 className="animate-spin w-4 h-4 sm:w-5 sm:h-5" />
                        Enviando...
                      </>
                    ) : emailSent ? (
                      <>
                        <Check size={18} className="sm:w-5 sm:h-5" />
                        ¡Enviado!
                      </>
                    ) : (
                      <>
                        <Send size={18} className="sm:w-5 sm:h-5" />
                        <span className="hidden sm:inline">Enviar Email</span>
                        <span className="sm:hidden">Email</span>
                      </>
                    )}
                  </button>
                </>
              ) : (
                <>
                  <button
                    onClick={handleSaveVoucherChanges}
                    disabled={isSaving}
                    className="flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 sm:px-6 py-3 rounded-lg transition font-semibold text-sm sm:text-base w-full sm:w-auto"
                  >
                    {isSaving ? (
                      <>
                        <Loader2 className="animate-spin w-4 h-4 sm:w-5 sm:h-5" />
                        Guardando...
                      </>
                    ) : saveSuccess ? (
                      <>
                        <Check size={18} className="sm:w-5 sm:h-5" />
                        Guardado
                      </>
                    ) : (
                      <>
                        <Save size={18} className="sm:w-5 sm:h-5" />
                        <span className="hidden sm:inline">
                          Guardar Cambios
                        </span>
                        <span className="sm:hidden">Guardar</span>
                      </>
                    )}
                  </button>
                  <button
                    onClick={() => {
                      setIsEditingVoucher(false);
                      setEditedVoucherData({
                        ...selectedVoucher.pdfData.passenger,
                        selectedHotel: selectedVoucher.pdfData.hotel?.id || "",
                        selectedTransport:
                          selectedVoucher.pdfData.transport?.id || "",
                        selectedRestaurant:
                          selectedVoucher.pdfData.restaurant?.id || "",
                        hotelServices: selectedVoucher.pdfData
                          .hotelServices || {
                          desayuno: false,
                          almuerzo: false,
                          snack: false,
                          cena: false,
                        },
                        emissionDate:
                          selectedVoucher.pdfData.emissionDate || "",
                        emissionPlace:
                          selectedVoucher.pdfData.emissionPlace || "",
                      });
                    }}
                    className="flex items-center justify-center gap-2 bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 sm:px-6 py-3 rounded-lg transition font-semibold text-sm sm:text-base w-full sm:w-auto"
                  >
                    <X size={18} className="sm:w-5 sm:h-5" />
                    Cancelar
                  </button>
                </>
              )}
            </div>

            {/* Mensajes de éxito */}
            {saveSuccess && !isSaving && (
              <div className="mt-4 bg-green-50 border border-green-200 rounded-lg p-3 sm:p-4">
                <div className="flex items-start gap-2">
                  <Check
                    className="text-green-600 w-5 h-5 flex-shrink-0 mt-0.5"
                    size={20}
                  />
                  <p className="text-green-800 font-semibold text-sm sm:text-base">
                    ¡Los cambios han sido guardados exitosamente!
                  </p>
                </div>
              </div>
            )}

            {emailSent && !isSendingEmail && (
              <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4">
                <div className="flex items-start gap-2">
                  <Check
                    className="text-blue-600 w-5 h-5 flex-shrink-0 mt-0.5"
                    size={20}
                  />
                  <p className="text-blue-800 font-semibold text-sm sm:text-base">
                    ¡El voucher ha sido enviado por email exitosamente!
                  </p>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }

  if (currentView === "dashboard") {
    const config = {
      airportLeader: { color: "red", name: "Líder Aeroportuario" },
      agent: { color: "green", name: "Agente" },
      airline: { color: "purple", name: "Línea Aérea" },
      admin: { color: "orange", name: "Administrador" },
    }[userRole];

    return (
      <div className="min-h-screen bg-slate-100 flex relative">
        {/* Sidebar */}
        <div
          className={`
          fixed lg:relative
          inset-y-0 left-0
          z-50 lg:z-0
          bg-slate-800 text-white
          transition-all duration-300 ease-in-out
          flex flex-col
          ${sidebarOpen ? "translate-x-0" : "-translate-x-full lg:translate-x-0"}
          ${sidebarOpen ? "w-64" : "-translate-x-full lg:w-20"}
      `}
        >
          <div className="p-4 flex items-center justify-between border-b border-slate-700">
            {sidebarOpen && (
              <div className="flex items-center gap-2">
                <Plane className="w-8 h-8" />
                <div>
                  <span className="font-bold text-lg block">AirportHub</span>
                  <span className="text-xs text-slate-400">Plus Ultra</span>
                </div>
              </div>
            )}
            <button
              onClick={() => setSidebarOpen(!sidebarOpen)}
              className="p-2 hover:bg-slate-700 rounded-lg transition"
            >
              {sidebarOpen ? <X size={20} /> : <Menu size={20} />}
            </button>
          </div>

          <div className="flex-1 p-4">
            <button
              onClick={handleReturnToRoleSelect}
              className="w-full text-left p-3 rounded-lg hover:bg-slate-700 transition flex items-center gap-3 text-blue-400"
            >
              <Home size={20} />
              {sidebarOpen && <span>Volver</span>}
            </button>
          </div>

          <div className="p-4 border-t border-slate-700">
            <button
              onClick={() => {
                setCurrentView("login");
                setUserRole(null);
              }}
              className="w-full text-left p-3 rounded-lg hover:bg-slate-700 transition flex items-center gap-3 text-red-400"
            >
              <LogOut size={20} />
              {sidebarOpen && <span>Cerrar Sesión</span>}
            </button>
          </div>
        </div>

        {/* Main Content */}
        <div className="flex-1 overflow-auto w-full">
          <div
            className={`bg-${config.color}-600 text-white p-4 lg:p-6 shadow-lg`}
          >
            <div className="flex items-center gap-3 lg:gap-4">
              <button
                onClick={() => setSidebarOpen(!sidebarOpen)}
                className="lg:hidden p-2 hover:bg-white/20 rounded-lg transition"
              >
                <Menu size={24} />
              </button>
              <div>
                <h1 className="text-xl lg:text-2xl font-bold">{config.name}</h1>
                <p className="text-xs lg:text-sm opacity-90">
                  Plus Ultra Airlines
                </p>
              </div>
            </div>
          </div>

          <div className="p-4 lg:p-6 min-h-[calc(100vh-88px)]">
            {/* VISTA DEL LÍDER AEROPORTUARIO */}

            {userRole === "airportLeader" && (
              <div className="max-w-5xl mx-auto space-y-6">
                {/* ========================================
FORMULARIO DE INFORMACIÓN DE VUELO
======================================== */}
                <div className="bg-white rounded-xl shadow-lg p-8">
                  <div className="flex items-center gap-3 mb-6">
                    <div className="bg-red-100 w-12 h-12 rounded-full flex items-center justify-center">
                      <Plane className="w-6 h-6 text-red-600" />
                    </div>
                    <div>
                      <h2 className="text-xl sm:text-2xl font-bold text-slate-800">
                        Registro de Información de Vuelo
                      </h2>
                      <p className="text-slate-600">
                        Información compartida con todos los roles
                      </p>
                    </div>
                  </div>

                  <div className="grid md:grid-cols-2 gap-6">
                    {/* Número de Vuelo */}
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Número de Vuelo *
                      </label>
                      <input
                        type="text"
                        value={flightData.flightNumber}
                        onChange={(e) =>
                          setFlightData({
                            ...flightData,
                            flightNumber: e.target.value,
                          })
                        }
                        placeholder="PU302"
                        className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none transition"
                      />
                    </div>

                    {/* Línea Aérea */}
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Línea Aérea *
                      </label>
                      <input
                        type="text"
                        value={flightData.airline}
                        onChange={(e) =>
                          setFlightData({
                            ...flightData,
                            airline: e.target.value,
                          })
                        }
                        placeholder="Plus Ultra"
                        className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none transition"
                      />
                    </div>

                    {/* Origen */}
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Origen
                      </label>
                      <div className="relative">
                        <Plane
                          className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 transform rotate-45"
                          size={20}
                        />
                        <input
                          type="text"
                          value={flightData.origin}
                          onChange={(e) =>
                            setFlightData({
                              ...flightData,
                              origin: e.target.value.toUpperCase(),
                            })
                          }
                          placeholder="MAD - Madrid"
                          className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none transition uppercase"
                          maxLength={30}
                        />
                      </div>
                    </div>

                    {/* Destino */}
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Destino
                      </label>
                      <div className="relative">
                        <Plane
                          className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 transform -rotate-45"
                          size={20}
                        />
                        <input
                          type="text"
                          value={flightData.destination}
                          onChange={(e) =>
                            setFlightData({
                              ...flightData,
                              destination: e.target.value.toUpperCase(),
                            })
                          }
                          placeholder="LIM - Lima"
                          className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none transition uppercase"
                          maxLength={30}
                        />
                      </div>
                    </div>

                    {/* Fecha */}
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Fecha *
                      </label>
                      <input
                        type="date"
                        value={flightData.date}
                        onChange={(e) =>
                          setFlightData({ ...flightData, date: e.target.value })
                        }
                        className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none transition"
                      />
                    </div>

                    {/* Hora */}
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Hora *
                      </label>
                      <input
                        type="time"
                        value={flightData.time}
                        onChange={(e) =>
                          setFlightData({ ...flightData, time: e.target.value })
                        }
                        className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none transition"
                      />
                    </div>

                    {/* Estado del Vuelo */}
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Estado del Vuelo *
                      </label>
                      <select
                        value={flightData.status}
                        onChange={(e) =>
                          setFlightData({
                            ...flightData,
                            status: e.target.value,
                          })
                        }
                        className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none transition"
                      >
                        <option value="programado">Programado</option>
                        <option value="reprogramado">Reprogramado</option>
                        <option value="cancelado">Cancelado</option>
                        <option value="demorado">Demorado</option>
                      </select>
                    </div>

                    {/* Notas / Observaciones */}
                    <div className="md:col-span-2">
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Notas / Observaciones
                      </label>
                      <textarea
                        value={flightData.notes}
                        onChange={(e) =>
                          setFlightData({
                            ...flightData,
                            notes: e.target.value,
                          })
                        }
                        placeholder="Ej: VUELO REPROGRAMADO"
                        rows={2}
                        className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none transition"
                      />
                    </div>
                  </div>
                </div>

                {/* ========================================
HABILITAR RECURSOS DEL DÍA
======================================== */}
                <div className="bg-white rounded-xl shadow-lg p-8">
                  <div className="flex items-center gap-3 mb-6">
                    <div className="bg-red-100 w-12 h-12 rounded-full flex items-center justify-center">
                      <Hotel className="w-6 h-6 text-red-600" />
                    </div>
                    <div>
                      <h2 className="text-xl sm:text-2xl font-bold text-slate-800">
                        Habilitar Recursos para el Día
                      </h2>
                      <p className="text-slate-600">
                        Seleccione qué recursos estarán disponibles para los
                        agentes
                      </p>
                    </div>
                  </div>

                  {/* HOTELES CON CAPACIDAD DETALLADA */}
                  <div className="mb-6">
                    <h3 className="text-lg font-semibold text-slate-800 mb-4">
                      Hoteles Disponibles
                    </h3>
                    <div className="relative">
                      <Hotel
                        className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none z-10"
                        size={20}
                      />
                      <select
                        value=""
                        onChange={(e) => {
                          const hotelId = parseInt(e.target.value);
                          if (
                            hotelId &&
                            !enabledResources.hotels.includes(hotelId)
                          ) {
                            setEnabledResources({
                              ...enabledResources,
                              hotels: [...enabledResources.hotels, hotelId],
                            });
                          }
                        }}
                        className="w-full pl-10 pr-4 py-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition bg-white appearance-none cursor-pointer"
                      >
                        <option value="">Seleccione hotel...</option>
                        {masterHotels
                          .filter(
                            (hotel, index, self) =>
                              index ===
                              self.findIndex((h) => h.name === hotel.name),
                          )
                          .filter(
                            (h) =>
                              h.activo &&
                              !enabledResources.hotels.includes(h.id),
                          )
                          .map((hotel) => (
                            <option key={hotel.id} value={hotel.id}>
                              {hotel.name}
                            </option>
                          ))}
                      </select>
                    </div>

                    {/* HOTELES SELECCIONADOS CON CONFIGURACIÓN DETALLADA */}
                    {enabledResources.hotels.length > 0 && (
                      <div className="mt-4 space-y-4">
                        {enabledResources.hotels.map((id) => {
                          const hotel = masterHotels.find((h) => h.id === id);
                          const capacity = hotelCapacities[id] || {
                            simple: 0,
                            doble: 0,
                            matrimonial: 0,
                          };
                          const totalRooms =
                            (capacity.simple || 0) +
                            (capacity.doble || 0) +
                            (capacity.matrimonial || 0);

                          return hotel ? (
                            <div
                              key={id}
                              className="border-2 border-red-200 rounded-lg p-5 bg-red-50"
                            >
                              {/* Header del Hotel */}
                              <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-3">
                                  <div className="bg-red-600 w-10 h-10 rounded-full flex items-center justify-center">
                                    <Hotel className="w-5 h-5 text-white" />
                                  </div>
                                  <div>
                                    <h4 className="text-lg font-bold text-slate-800">
                                      {hotel.name}
                                    </h4>
                                    <p className="text-sm text-slate-600">
                                      Total: {totalRooms} habitaciones
                                    </p>
                                  </div>
                                </div>
                                <button
                                  onClick={() => toggleHotelSelection(id)}
                                  className="p-2 hover:bg-red-200 rounded-full transition"
                                  title="Eliminar hotel"
                                >
                                  <X size={20} className="text-red-600" />
                                </button>
                              </div>

                              {/* Configuración de Habitaciones */}
                              
                            {/* Configuración de Habitaciones CON PRECIOS */}
<div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
  {/* Habitaciones Simples */}
  <div className="bg-white rounded-lg p-4 border border-slate-200">
    <label className="block text-sm font-semibold text-slate-700 mb-2">
      Habitaciones Simples
    </label>
    
    {/* Cantidad */}
    <div className="relative mb-3">
      <User
        className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
        size={18}
      />
      <input
        type="number"
        min="0"
        max="999"
        value={capacity.simple || ""}
        onChange={(e) => {
          const newCapacities = {
            ...hotelCapacities,
            [id]: {
              ...capacity,
              simple: parseInt(e.target.value) || 0,
            },
          };
          setHotelCapacities(newCapacities);
        }}
        placeholder="Cantidad"
        className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-center font-semibold"
      />
    </div>
    
    {/* Precio */}
    <div className="relative">
      <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-600 font-bold">
        S/
      </span>
      <input
        type="number"
        min="0"
        step="0.01"
        value={hotelPrices[id]?.simple || ""}
        onChange={(e) => {
          const newPrices = {
            ...hotelPrices,
            [id]: {
              ...(hotelPrices[id] || { simple: 0, doble: 0, matrimonial: 0 }),
              simple: parseFloat(e.target.value) || 0,
            },
          };
          setHotelPrices(newPrices);
        }}
        placeholder="Precio"
        className="w-full pl-10 pr-4 py-2 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none text-center font-semibold bg-green-50"
      />
    </div>
    <p className="text-xs text-slate-500 mt-2 text-center">
      1 persona por habitación
    </p>
  </div>

  {/* Habitaciones Dobles */}
  <div className="bg-white rounded-lg p-4 border border-slate-200">
    <label className="block text-sm font-semibold text-slate-700 mb-2">
      Habitaciones Dobles
    </label>
    
    {/* Cantidad */}
    <div className="relative mb-3">
      <Users
        className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
        size={18}
      />
      <input
        type="number"
        min="0"
        max="999"
        value={capacity.doble || ""}
        onChange={(e) => {
          const newCapacities = {
            ...hotelCapacities,
            [id]: {
              ...capacity,
              doble: parseInt(e.target.value) || 0,
            },
          };
          setHotelCapacities(newCapacities);
        }}
        placeholder="Cantidad"
        className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-center font-semibold"
      />
    </div>
    
    {/* Precio */}
    <div className="relative">
      <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-600 font-bold">
        S/
      </span>
      <input
        type="number"
        min="0"
        step="0.01"
        value={hotelPrices[id]?.doble || ""}
        onChange={(e) => {
          const newPrices = {
            ...hotelPrices,
            [id]: {
              ...(hotelPrices[id] || { simple: 0, doble: 0, matrimonial: 0 }),
              doble: parseFloat(e.target.value) || 0,
            },
          };
          setHotelPrices(newPrices);
        }}
        placeholder="Precio"
        className="w-full pl-10 pr-4 py-2 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none text-center font-semibold bg-green-50"
      />
    </div>
    <p className="text-xs text-slate-500 mt-2 text-center">
      2 camas individuales
    </p>
  </div>

  {/* Habitaciones Matrimoniales */}
  <div className="bg-white rounded-lg p-4 border border-slate-200">
    <label className="block text-sm font-semibold text-slate-700 mb-2">
      Habitaciones Matrimoniales
    </label>
    
    {/* Cantidad */}
    <div className="relative mb-3">
      <Users
        className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
        size={18}
      />
      <input
        type="number"
        min="0"
        max="999"
        value={capacity.matrimonial || ""}
        onChange={(e) => {
          const newCapacities = {
            ...hotelCapacities,
            [id]: {
              ...capacity,
              matrimonial: parseInt(e.target.value) || 0,
            },
          };
          setHotelCapacities(newCapacities);
        }}
        placeholder="Cantidad"
        className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-center font-semibold"
      />
    </div>
    
    {/* Precio */}
    <div className="relative">
      <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-600 font-bold">
        S/
      </span>
      <input
        type="number"
        min="0"
        step="0.01"
        value={hotelPrices[id]?.matrimonial || ""}
        onChange={(e) => {
          const newPrices = {
            ...hotelPrices,
            [id]: {
              ...(hotelPrices[id] || { simple: 0, doble: 0, matrimonial: 0 }),
              matrimonial: parseFloat(e.target.value) || 0,
            },
          };
          setHotelPrices(newPrices);
        }}
        placeholder="Precio"
        className="w-full pl-10 pr-4 py-2 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none text-center font-semibold bg-green-50"
      />
    </div>
    <p className="text-xs text-slate-500 mt-2 text-center">
      1 cama matrimonial
    </p>
  </div>
</div>

                              {/* Resumen Visual */}
                              {/* {totalRooms > 0 && (
                                <div className="mt-4 pt-4 border-t border-red-200">
                                  <div className="flex items-center justify-between text-sm">
                                    <span className="font-semibold text-slate-700">
                                      Resumen de Capacidad:
                                    </span>
                                    <div className="flex items-center gap-4">
                                      {capacity.simple > 0 && (
                                        <span className="text-slate-600">
                                          <span className="font-bold text-red-600">
                                            {capacity.simple}
                                          </span>{" "}
                                          Simples
                                        </span>
                                      )}
                                      {capacity.doble > 0 && (
                                        <span className="text-slate-600">
                                          <span className="font-bold text-red-600">
                                            {capacity.doble}
                                          </span>{" "}
                                          Dobles
                                        </span>
                                      )}
                                      {capacity.matrimonial > 0 && (
                                        <span className="text-slate-600">
                                          <span className="font-bold text-red-600">
                                            {capacity.matrimonial}
                                          </span>{" "}
                                          Matrimoniales
                                        </span>
                                      )}
                                    </div>
                                  </div>
                                </div>
                              )} */}
                              {totalRooms > 0 && (
                                <div className="mt-4 pt-4 border-t border-red-200">
                                  <p className="font-semibold text-slate-700 text-sm text-center mb-2">
                                    Resumen de Capacidad:
                                  </p>
                                  <div className="flex items-center justify-center gap-6">
                                    {capacity.simple > 0 && (
                                      <div className="text-center">
                                        <p className="font-bold text-red-600 text-lg">
                                          {capacity.simple}
                                        </p>
                                        <p className="text-slate-600 text-xs">
                                          Simples
                                        </p>
                                      </div>
                                    )}
                                    {capacity.doble > 0 && (
                                      <div className="text-center">
                                        <p className="font-bold text-red-600 text-lg">
                                          {capacity.doble}
                                        </p>
                                        <p className="text-slate-600 text-xs">
                                          Dobles
                                        </p>
                                      </div>
                                    )}
                                    {capacity.matrimonial > 0 && (
                                      <div className="text-center">
                                        <p className="font-bold text-red-600 text-lg">
                                          {capacity.matrimonial}
                                        </p>
                                        <p className="text-slate-600 text-xs">
                                          Matrimoniales
                                        </p>
                                      </div>
                                    )}
                                  </div>
                                </div>
                              )}
                            </div>
                          ) : null;
                        })}
                      </div>
                    )}
                  </div>

                  {/* TRANSPORTES */}
                  <div className="mb-6">
                    <h3 className="text-lg font-semibold text-slate-800 mb-4">
                      Transportes Disponibles
                    </h3>
                    <div className="relative">
                      <Truck
                        className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none z-10"
                        size={20}
                      />
                      <select
                        value=""
                        onChange={(e) => {
                          const transportId = parseInt(e.target.value);
                          if (
                            transportId &&
                            !enabledResources.transports.includes(transportId)
                          ) {
                            setEnabledResources({
                              ...enabledResources,
                              transports: [
                                ...enabledResources.transports,
                                transportId,
                              ],
                            });
                          }
                        }}
                        className="w-full pl-10 pr-4 py-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition bg-white appearance-none cursor-pointer"
                      >
                        <option value="">Seleccione transporte...</option>
                        {masterTransports
                          .filter(
                            (transport, index, self) =>
                              index ===
                              self.findIndex((t) => t.name === transport.name),
                          )
                          .filter(
                            (t) =>
                              t.activo &&
                              !enabledResources.transports.includes(t.id),
                          )
                          .map((transport) => (
                            <option key={transport.id} value={transport.id}>
                              {transport.name} - {transport.type}
                            </option>
                          ))}
                      </select>
                    </div>

                    {enabledResources.transports.length > 0 && (
                      <div className="mt-3 flex flex-wrap gap-2">
                        {enabledResources.transports.map((id) => {
                          const transport = masterTransports.find(
                            (t) => t.id === id,
                          );
                          return transport ? (
                            <span
                              key={id}
                              className="inline-flex items-center gap-2 px-3 py-1 bg-red-100 text-red-800 text-sm font-semibold rounded-full"
                            >
                              {transport.name}
                              <button
                                onClick={() => toggleTransportSelection(id)}
                                className="hover:bg-red-200 rounded-full p-1 transition"
                              >
                                <X size={14} />
                              </button>
                            </span>
                          ) : null;
                        })}
                      </div>
                    )}
                  </div>

                  {/* RESTAURANTES */}
                  <div className="mb-6">
                    <h3 className="text-lg font-semibold text-slate-800 mb-4">
                      Restaurantes Disponibles
                    </h3>
                    <div className="relative">
                      <Utensils
                        className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none z-10"
                        size={20}
                      />
                      <select
                        value=""
                        onChange={(e) => {
                          const restaurantId = parseInt(e.target.value);
                          if (
                            restaurantId &&
                            !enabledResources.restaurants.includes(restaurantId)
                          ) {
                            setEnabledResources({
                              ...enabledResources,
                              restaurants: [
                                ...enabledResources.restaurants,
                                restaurantId,
                              ],
                            });
                          }
                        }}
                        className="w-full pl-10 pr-4 py-3 border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition bg-white appearance-none cursor-pointer"
                      >
                        <option value="">Seleccione restaurante...</option>
                        {masterRestaurants
                          .filter(
                            (restaurant, index, self) =>
                              index ===
                              self.findIndex((r) => r.name === restaurant.name),
                          )
                          .filter(
                            (r) =>
                              r.activo &&
                              !enabledResources.restaurants.includes(r.id),
                          )
                          .map((restaurant) => (
                            <option key={restaurant.id} value={restaurant.id}>
                              {restaurant.name} - {restaurant.cuisine}
                            </option>
                          ))}
                      </select>
                    </div>

                    {enabledResources.restaurants.length > 0 && (
                      <div className="mt-3 flex flex-wrap gap-2">
                        {enabledResources.restaurants.map((id) => {
                          const restaurant = masterRestaurants.find(
                            (r) => r.id === id,
                          );
                          return restaurant ? (
                            <span
                              key={id}
                              className="inline-flex items-center gap-2 px-3 py-1 bg-red-100 text-red-800 text-sm font-semibold rounded-full"
                            >
                              {restaurant.name}
                              <button
                                onClick={() => toggleRestaurantSelection(id)}
                                className="hover:bg-red-200 rounded-full p-1 transition"
                              >
                                <X size={14} />
                              </button>
                            </span>
                          ) : null;
                        })}
                      </div>
                    )}
                  </div>

                  {/* BOTÓN DE GUARDADO ÚNICO */}
                  <div className="mt-8 pt-6 border-t border-slate-200">
                    <button
                      onClick={handleSaveAllData}
                      disabled={isSaving}
                      className="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 disabled:from-gray-400 disabled:to-gray-400 text-white font-bold py-4 rounded-lg transition flex items-center justify-center gap-2 shadow-lg hover:shadow-xl"
                    >
                      {isSaving ? (
                        <>
                          <Loader2 className="animate-spin" size={24} />
                          Guardando Configuración...
                        </>
                      ) : saveSuccess ? (
                        <>
                          <Check size={24} />
                          ¡Configuración Guardada!
                        </>
                      ) : (
                        <>
                          <Check size={24} />
                          Guardar Información de Vuelo
                        </>
                      )}
                    </button>

                    {/* Mensaje de éxito */}
                    {saveSuccess && (
                      <div className="mt-4 bg-green-50 border border-green-200 rounded-lg p-4">
                        <div className="flex items-center gap-2 mb-2">
                          <Check className="text-green-600" size={20} />
                          <p className="text-green-800 font-semibold">
                            ¡Configuración guardada exitosamente!
                          </p>
                        </div>
                        <div className="ml-7 space-y-1 text-sm text-green-700">
                          <p>
                            ✓ Información del vuelo: {flightData.flightNumber}{" "}
                            guardada
                          </p>
                          {flightData.origin && flightData.destination && (
                            <p>
                              ✓ Ruta: {flightData.origin} →{" "}
                              {flightData.destination}
                            </p>
                          )}
                          <p>
                            ✓ Recursos habilitados:{" "}
                            {enabledResources.hotels.length +
                              enabledResources.transports.length +
                              enabledResources.restaurants.length}{" "}
                            recursos disponibles para agentes
                          </p>
                          {enabledResources.hotels.length > 0 && (
                            <p>
                              ✓ Hoteles configurados con capacidades específicas
                            </p>
                          )}
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                {/* RESUMEN DE RECURSOS HABILITADOS */}
                {(enabledResources.hotels.length > 0 ||
                  enabledResources.transports.length > 0 ||
                  enabledResources.restaurants.length > 0) && (
                  <div className="bg-white rounded-xl shadow-lg p-8">
                    <h3 className="text-xl font-bold text-slate-800 mb-4">
                      Resumen de Recursos Habilitados
                    </h3>
                    <div className="space-y-4">
                      {/* Hoteles con detalle de capacidades */}
                      {/* {enabledResources.hotels.length > 0 && (
                        <div className="border border-slate-200 rounded-lg p-4 bg-red-50">
                          <div className="flex items-start gap-3">
                            <Hotel className="w-6 h-6 text-red-600 mt-1" />
                            <div className="flex-1 min-w-0">
                              <h4 className="font-semibold text-slate-800 mb-3">
                                Hoteles ({enabledResources.hotels.length})
                              </h4>
                              <div className="space-y-3">
                                {enabledResources.hotels.map((id) => {
                                  const hotel = masterHotels.find(
                                    (h) => h.id === id,
                                  );
                                  const capacity = hotelCapacities[id] || {
                                    simple: 0,
                                    doble: 0,
                                    matrimonial: 0,
                                  };
                                  const totalRooms =
                                    (capacity.simple || 0) +
                                    (capacity.doble || 0) +
                                    (capacity.matrimonial || 0);

                                  return hotel ? (
                                    <div
                                      key={id}
                                      className="bg-white rounded-lg p-4 border border-red-200 text-center"
                                    >
                                      <p className="font-semibold text-slate-800 text-base mb-1">
                                        {hotel.name}
                                      </p>
                                      <p className="text-sm text-slate-500 mb-3">
                                        Total: {totalRooms} habitaciones
                                      </p>
                                      {totalRooms > 0 && (
                                        <div className="flex items-center justify-center gap-6">
                                          {capacity.simple > 0 && (
                                            <div>
                                              <p className="font-bold text-red-600 text-lg">
                                                {capacity.simple}
                                              </p>
                                              <p className="text-xs text-slate-600">
                                                Simples
                                              </p>
                                            </div>
                                          )}
                                          {capacity.doble > 0 && (
                                            <div>
                                              <p className="font-bold text-red-600 text-lg">
                                                {capacity.doble}
                                              </p>
                                              <p className="text-xs text-slate-600">
                                                Dobles
                                              </p>
                                            </div>
                                          )}
                                          {capacity.matrimonial > 0 && (
                                            <div>
                                              <p className="font-bold text-red-600 text-lg">
                                                {capacity.matrimonial}
                                              </p>
                                              <p className="text-xs text-slate-600">
                                                Matrimoniales
                                              </p>
                                            </div>
                                          )}
                                        </div>
                                      )}
                                    </div>
                                  ) : null;
                                })}
                              </div>
                            </div>
                          </div>
                        </div>
                      )} */}
                      {enabledResources.hotels.length > 0 && (
                        <div className="border border-slate-200 rounded-lg p-4 bg-red-50">
                          <div className="flex items-center gap-3 mb-3">
                            <Hotel className="w-6 h-6 text-red-600" />
                            <h4 className="font-semibold text-slate-800">
                              Hoteles ({enabledResources.hotels.length})
                            </h4>
                          </div>
                          <div className="space-y-3">
                            {enabledResources.hotels.map((id) => {
                              const hotel = masterHotels.find(
                                (h) => h.id === id,
                              );
                              const capacity = hotelCapacities[id] || {
                                simple: 0,
                                doble: 0,
                                matrimonial: 0,
                              };
                              const totalRooms =
                                (capacity.simple || 0) +
                                (capacity.doble || 0) +
                                (capacity.matrimonial || 0);

                              return hotel ? (
                                <div
                                  key={id}
                                  className="bg-white rounded-lg p-4 border border-red-200 text-center"
                                >
                                  <p className="font-semibold text-slate-800 text-base mb-1">
                                    {hotel.name}
                                  </p>
                                  <p className="text-sm text-slate-500 mb-3">
                                    Total: {totalRooms} habitaciones
                                  </p>
                                  {totalRooms > 0 && (
                                    <div className="flex items-center justify-center gap-6">
                                      {capacity.simple > 0 && (
                                        <div>
                                          <p className="font-bold text-red-600 text-lg">
                                            {capacity.simple}
                                          </p>
                                          <p className="text-xs text-slate-600">
                                            Simples
                                          </p>
                                        </div>
                                      )}
                                      {capacity.doble > 0 && (
                                        <div>
                                          <p className="font-bold text-red-600 text-lg">
                                            {capacity.doble}
                                          </p>
                                          <p className="text-xs text-slate-600">
                                            Dobles
                                          </p>
                                        </div>
                                      )}
                                      {capacity.matrimonial > 0 && (
                                        <div>
                                          <p className="font-bold text-red-600 text-lg">
                                            {capacity.matrimonial}
                                          </p>
                                          <p className="text-xs text-slate-600">
                                            Matrimoniales
                                          </p>
                                        </div>
                                      )}
                                    </div>
                                  )}
                                </div>
                              ) : null;
                            })}
                          </div>
                        </div>
                      )}

                      {/* Transportes */}
                      {enabledResources.transports.length > 0 && (
                        <div className="border border-slate-200 rounded-lg p-4">
                          <div className="flex items-center gap-3">
                            <Truck className="w-5 h-5 text-red-600" />
                            <div>
                              <h4 className="font-semibold text-slate-800">
                                Transportes (
                                {enabledResources.transports.length})
                              </h4>
                              <div className="flex flex-wrap gap-2 mt-2">
                                {enabledResources.transports.map((id) => {
                                  const transport = masterTransports.find(
                                    (t) => t.id === id,
                                  );
                                  return transport ? (
                                    <span
                                      key={id}
                                      className="px-3 py-1 bg-slate-100 text-slate-800 text-xs font-semibold rounded-full"
                                    >
                                      {transport.name}
                                    </span>
                                  ) : null;
                                })}
                              </div>
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Restaurantes */}
                      {enabledResources.restaurants.length > 0 && (
                        <div className="border border-slate-200 rounded-lg p-4">
                          <div className="flex items-center gap-3">
                            <Utensils className="w-5 h-5 text-red-600" />
                            <div>
                              <h4 className="font-semibold text-slate-800">
                                Restaurantes (
                                {enabledResources.restaurants.length})
                              </h4>
                              <div className="flex flex-wrap gap-2 mt-2">
                                {enabledResources.restaurants.map((id) => {
                                  const restaurant = masterRestaurants.find(
                                    (r) => r.id === id,
                                  );
                                  return restaurant ? (
                                    <span
                                      key={id}
                                      className="px-3 py-1 bg-slate-100 text-slate-800 text-xs font-semibold rounded-full"
                                    >
                                      {restaurant.name}
                                    </span>
                                  ) : null;
                                })}
                              </div>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </div>
            )}

            {userRole === "agent" && (
              <div className="space-y-6">
                {/* ========================================
    PANEL INFORMATIVO DE VUELO
    ======================================== */}
                <div className="bg-blue-50 border border-blue-200 rounded-xl p-6">
                  <h3 className="text-lg font-bold text-blue-800 mb-4 flex items-center gap-2">
                    <Plane className="w-5 h-5" /> Información del Vuelo
                  </h3>
                  {flightData.flightNumber ? (
                    <div className="space-y-3">
                      <div className="grid md:grid-cols-4 gap-4 text-sm">
                        <div>
                          <span className="font-semibold text-blue-900">
                            Vuelo:
                          </span>
                          <p className="text-blue-700 mt-1">
                            {flightData.flightNumber} - {flightData.airline}
                          </p>
                        </div>
                        <div>
                          <span className="font-semibold text-blue-900">
                            Ruta:
                          </span>
                          <p className="text-blue-700 mt-1">
                            {flightData.origin || "N/A"} →{" "}
                            {flightData.destination || "N/A"}
                          </p>
                        </div>
                        <div>
                          <span className="font-semibold text-blue-900">
                            Fecha/Hora:
                          </span>
                          <p className="text-blue-700 mt-1">
                            {flightData.date} - {flightData.time}
                          </p>
                        </div>
                        <div>
                          <span className="font-semibold text-blue-900">
                            Estado:
                          </span>
                          <div className="mt-1">
                            <span
                              className={`px-2 py-1 rounded-full text-xs font-semibold ${
                                flightData.status === "programado"
                                  ? "bg-green-100 text-green-800"
                                  : flightData.status === "reprogramado"
                                    ? "bg-yellow-100 text-yellow-800"
                                    : "bg-red-100 text-red-800"
                              }`}
                            >
                              {flightData.status.toUpperCase()}
                            </span>
                          </div>
                        </div>
                      </div>
                      {flightData.notes && (
                        <div className="pt-3 border-t border-blue-200">
                          <span className="font-semibold text-blue-900">
                            Notas/Remarks:
                          </span>
                          <p className="text-blue-700 mt-1">
                            {flightData.notes}
                          </p>
                        </div>
                      )}
                    </div>
                  ) : (
                    <div className="flex items-center gap-2 text-blue-700">
                      <AlertCircle size={20} />
                      <p>
                        El líder aeroportuario aún no ha registrado la
                        información del vuelo
                      </p>
                    </div>
                  )}
                </div>

                {/* ========================================
    ✅ CAMBIO 4: CONTADOR DE RECURSOS DISPONIBLES - MEJORADO
    ======================================== */}
                {(enabledResources.hotels.length > 0 ||
                  enabledResources.transports.length > 0 ||
                  enabledResources.restaurants.length > 0) && (
                  <div className="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6">
                    <h3 className="text-lg font-bold text-green-800 mb-4 flex items-center gap-2">
                      <Hotel className="w-5 h-5" /> Recursos Disponibles para
                      Hoy
                    </h3>
                    <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                      {/* ✅ CONTADOR DE HOTELES MEJORADO - Solo disminuye cuando se agotan TODAS las habitaciones */}
                      {enabledResources.hotels.length > 0 && (
                        <div className="bg-white rounded-lg p-4 border-2 border-green-300">
                          <div className="flex items-center justify-between mb-2">
                            <span className="text-sm font-semibold text-slate-700">
                              Hoteles
                            </span>
                            <Hotel className="w-5 h-5 text-green-600" />
                          </div>
                          <div className="text-3xl font-bold text-green-600">
                            {(() => {
                              // ✅ NUEVA LÓGICA: Contar hoteles con al menos 1 habitación disponible
                              const availableHotelsCount =
                                enabledResources.hotels.filter((hotelId) => {
                                  if (usedResources.hotels.includes(hotelId)) {
                                    return false; // Hotel completamente agotado
                                  }
                                  return true; // Hotel disponible
                                }).length;

                              return availableHotelsCount;
                            })()}
                          </div>
                          <p className="text-xs text-slate-600 mt-1">
                            de {enabledResources.hotels.length} disponibles
                          </p>

                          {/* ✅ DESGLOSE DE HABITACIONES DISPONIBLES */}
                          <div className="mt-3 pt-3 border-t border-slate-200">
                            <p className="text-xs font-semibold text-slate-600 mb-2">
                              Habitaciones disponibles:
                            </p>
                            <div className="space-y-1">
                              {enabledResources.hotels.map((hotelId) => {
                                const hotel = masterHotels.find(
                                  (h) => h.id === hotelId,
                                );
                                const capacity = hotelCapacities[hotelId] || {
                                  simple: 0,
                                  doble: 0,
                                  matrimonial: 0,
                                };

                                // ✅ Calcular habitaciones usadas en el estado global
                                const usedGlobal = usedRooms[hotelId] || {
                                  simple: 0,
                                  doble: 0,
                                  matrimonial: 0,
                                };

                                const remaining = {
                                  simple: Math.max(
                                    0,
                                    capacity.simple - usedGlobal.simple,
                                  ),
                                  doble: Math.max(
                                    0,
                                    capacity.doble - usedGlobal.doble,
                                  ),
                                  matrimonial: Math.max(
                                    0,
                                    capacity.matrimonial -
                                      usedGlobal.matrimonial,
                                  ),
                                };

                                const totalRemaining =
                                  remaining.simple +
                                  remaining.doble +
                                  remaining.matrimonial;
                                const totalCapacity =
                                  capacity.simple +
                                  capacity.doble +
                                  capacity.matrimonial;

                                if (totalCapacity === 0) return null;

                                return (
                                  <div key={hotelId} className="text-xs">
                                    <span className="font-semibold text-slate-700">
                                      {hotel?.name}:
                                    </span>
                                    <span
                                      className={`ml-1 ${totalRemaining === 0 ? "text-red-600 font-bold" : "text-green-700"}`}
                                    >
                                      {totalRemaining}/{totalCapacity}{" "}
                                      disponibles
                                    </span>
                                    {totalRemaining > 0 && (
                                      <div className="ml-2 text-xs text-slate-600">
                                        {remaining.simple > 0 && (
                                          <span className="mr-2">
                                            S:{remaining.simple}
                                          </span>
                                        )}
                                        {remaining.doble > 0 && (
                                          <span className="mr-2">
                                            D:{remaining.doble}
                                          </span>
                                        )}
                                        {remaining.matrimonial > 0 && (
                                          <span>M:{remaining.matrimonial}</span>
                                        )}
                                      </div>
                                    )}
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Contador de Transportes */}
                      {enabledResources.transports.length > 0 && (
                        <div className="bg-white rounded-lg p-4 border-2 border-blue-300">
                          <div className="flex items-center justify-between mb-2">
                            <span className="text-sm font-semibold text-slate-700">
                              Transportes
                            </span>
                            <Truck className="w-5 h-5 text-blue-600" />
                          </div>
                          <div className="text-3xl font-bold text-blue-600">
                            {enabledResources.transports.length -
                              usedResources.transports.length}
                          </div>
                          <p className="text-xs text-slate-600 mt-1">
                            de {enabledResources.transports.length} disponibles
                          </p>
                        </div>
                      )}

                      {/* Contador de Restaurantes */}
                      {enabledResources.restaurants.length > 0 && (
                        <div className="bg-white rounded-lg p-4 border-2 border-orange-300">
                          <div className="flex items-center justify-between mb-2">
                            <span className="text-sm font-semibold text-slate-700">
                              Restaurantes
                            </span>
                            <Utensils className="w-5 h-5 text-orange-600" />
                          </div>
                          <div className="text-3xl font-bold text-orange-600">
                            {enabledResources.restaurants.length -
                              usedResources.restaurants.length}
                          </div>
                          <p className="text-xs text-slate-600 mt-1">
                            de {enabledResources.restaurants.length} disponibles
                          </p>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* ========================================
    ESCANEO DE BOARDING PASS
    ======================================== */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="text-lg font-bold text-slate-800">
                      Escanear Boarding Pass Plus Ultra
                    </h3>
                    <label className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg transition cursor-pointer">
                      <Upload size={25} /> Subir Imagen
                      <input
                        type="file"
                        accept="image/*"
                        onChange={handleImageUpload}
                        className="hidden"
                      />
                    </label>
                  </div>

                  {isScanning && (
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                      <div className="flex items-center gap-3">
                        <Loader2
                          className="animate-spin text-blue-600"
                          size={24}
                        />
                        <div>
                          <p className="text-blue-800 font-semibold">
                            Procesando imagen...
                          </p>
                          <p className="text-sm text-blue-700">
                            Extrayendo información del boarding pass
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {scannedData && !isScanning && (
                    <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                      <div className="flex items-center gap-2">
                        <Check className="text-green-600" size={20} />
                        <div>
                          <p className="text-green-800 font-semibold">
                            ✓ Boarding pass escaneado exitosamente
                          </p>
                          <p className="text-sm text-green-700 mt-1">
                            Pasajero: {scannedData.name} | PNR:{" "}
                            {scannedData.pnr}
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Lista de pasajeros registrados */}
                  {multiplePassengers.length > 0 && (
                    <div className="mb-4 border border-blue-200 rounded-lg p-4 bg-blue-50">
                      <h4 className="text-sm font-semibold text-blue-900 mb-3">
                        Pasajeros Registrados ({multiplePassengers.length})
                      </h4>
                      <div className="space-y-2">
                        {multiplePassengers.map((passenger, index) => (
  <div
    key={passenger.id}
    className="flex items-start justify-between bg-white p-3 rounded-lg border border-blue-200 gap-3"
  >
    <div className="flex items-start gap-3 flex-1 min-w-0">
      <span className="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm flex-shrink-0">
        {index + 1}
      </span>
      <div className="flex-1 min-w-0">
        <p className="font-semibold text-slate-800">
          {passenger.name}
        </p>
        <p className="text-xs text-slate-600">
          PNR: {passenger.pnr} | Email: {passenger.email}
          {passenger.roomSelection && (
            <span className="ml-2 text-green-700 font-semibold">
              | Habitaciones:
              {passenger.roomSelection.simple > 0 &&
                ` ${passenger.roomSelection.simple} Simple(s)`}
              {passenger.roomSelection.doble > 0 &&
                ` ${passenger.roomSelection.doble} Doble(s)`}
              {passenger.roomSelection.matrimonial > 0 &&
                ` ${passenger.roomSelection.matrimonial} Matrimonial(es)`}
            </span>
          )}
        </p>
        {/* ✅ MOSTRAR COSTO */}
        {passenger.hotelCost > 0 && (
          <p className="text-xs mt-1">
            <span className="inline-block px-2 py-1 bg-green-100 text-green-800 rounded font-bold">
              Costo Hotel: S/ {passenger.hotelCost.toFixed(2)}
            </span>
          </p>
        )}
      </div>
    </div>
    <button
      onClick={() => {
        setMultiplePassengers(
          multiplePassengers.filter((p) => p.id !== passenger.id)
        );
      }}
      className="p-2 hover:bg-red-100 rounded-full transition text-red-600 shrink-0 self-end"
      title="Eliminar pasajero"
    >
      <X size={18} />
    </button>
  </div>
))}
                      </div>
                    </div>
                  )}
                </div>

                {/* ========================================
    FORMULARIO DE PASAJERO Y SERVICIOS
    ======================================== */}
                <div className="bg-white rounded-xl shadow-lg p-8">
                  <h2 className="text-2xl font-bold text-slate-800 mb-6">
                    Registro de Pasajero y Servicios
                  </h2>

                  <div className="space-y-6">
                    {/* Datos del pasajero */}
                    <div className="border-b border-slate-200 pb-6">
                      <h3 className="text-lg font-semibold text-slate-700 mb-4">
                        Datos del Pasajero
                      </h3>
                      <div className="grid md:grid-cols-2 gap-6">
                        <div className="md:col-span-2">
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Nombre Completo *
                          </label>
                          <input
                            type="text"
                            value={passengerData.name}
                            onChange={(e) =>
                              setPassengerData({
                                ...passengerData,
                                name: e.target.value,
                              })
                            }
                            placeholder="Nombre del pasajero"
                            className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition"
                          />
                        </div>

                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            PNR *
                          </label>
                          <input
                            type="text"
                            value={passengerData.pnr}
                            onChange={(e) =>
                              setPassengerData({
                                ...passengerData,
                                pnr: e.target.value,
                              })
                            }
                            placeholder="WSVFKR"
                            className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition"
                          />
                        </div>

                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Correo Electrónico *
                          </label>
                          <input
                            type="email"
                            value={passengerData.email}
                            onChange={(e) =>
                              setPassengerData({
                                ...passengerData,
                                email: e.target.value,
                              })
                            }
                            placeholder="pasajero@ejemplo.com"
                            className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition"
                          />
                        </div>
                      </div>

                      {/* Botón Agregar Siguiente Pasajero */}
                      <div className="mt-4">
                        <button
                          onClick={handleAddNextPassenger}
                          disabled={
                            !passengerData.name ||
                            !passengerData.pnr ||
                            !passengerData.email
                          }
                          className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg transition font-semibold"
                        >
                          <Users size={20} />
                          Agregar Siguiente Pasajero
                        </button>
                        <p className="text-xs text-slate-500 mt-2">
                          * Complete nombre, PNR y email, luego haga clic para
                          agregar más pasajeros
                        </p>
                      </div>
                    </div>

                    {/* Información de emisión */}
                    <div className="border-b border-slate-200 pb-6">
                      <h3 className="text-lg font-semibold text-slate-700 mb-4">
                        Información de Emisión
                      </h3>
                      <div className="grid md:grid-cols-2 gap-6">
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Fecha de Emisión *
                          </label>
                          <div className="relative">
                            <Calendar
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="date"
                              value={passengerData.emissionDate}
                              onChange={(e) =>
                                setPassengerData({
                                  ...passengerData,
                                  emissionDate: e.target.value,
                                })
                              }
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition"
                            />
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Lugar de Emisión *
                          </label>
                          <div className="relative">
                            <MapPin
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="text"
                              value={passengerData.emissionPlace}
                              onChange={(e) =>
                                setPassengerData({
                                  ...passengerData,
                                  emissionPlace: e.target.value,
                                })
                              }
                              placeholder="LIM/PU"
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition"
                            />
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Asignación de servicios */}
                    <div>
                      <h3 className="text-lg font-semibold text-slate-700 mb-4">
                        Asignación de Servicios
                      </h3>

                      {enabledResources.hotels.length === 0 &&
                        enabledResources.transports.length === 0 &&
                        enabledResources.restaurants.length === 0 && (
                          <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                            <div className="flex items-center gap-2">
                              <AlertCircle
                                className="text-orange-600"
                                size={20}
                              />
                              <p className="text-orange-800 font-semibold">
                                El líder aeroportuario aún no ha habilitado
                                recursos para el día
                              </p>
                            </div>
                          </div>
                        )}

                      <div className="space-y-6">
                        {/* ✅ CAMBIO 5: HOTEL con selección de habitaciones MEJORADO */}
                        {enabledResources.hotels.length > 0 && (
                          <div>
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                              Hotel
                            </label>
                            <div className="relative">
                              <Hotel
                                className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                                size={20}
                              />
                              <select
                                value={passengerData.selectedHotel}
                                onChange={(e) =>
                                  setPassengerData({
                                    ...passengerData,
                                    selectedHotel: e.target.value,
                                    roomSelection: {
                                      simple: 0,
                                      doble: 0,
                                      matrimonial: 0,
                                    },
                                  })
                                }
                                className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition appearance-none"
                              >
                                <option value="">Seleccione hotel...</option>
                                {getAvailableHotelsForAgent().map((hotel) => {
                                  // ✅ Calcular habitaciones disponibles REALES
                                  const capacity = hotelCapacities[
                                    hotel.id
                                  ] || {
                                    simple: 0,
                                    doble: 0,
                                    matrimonial: 0,
                                  };

                                  // ✅ Usar usedRooms en lugar de calcular desde multiplePassengers
                                  const usedGlobal = usedRooms[hotel.id] || {
                                    simple: 0,
                                    doble: 0,
                                    matrimonial: 0,
                                  };

                                  const totalCapacity =
                                    capacity.simple +
                                    capacity.doble +
                                    capacity.matrimonial;
                                  const totalUsed =
                                    usedGlobal.simple +
                                    usedGlobal.doble +
                                    usedGlobal.matrimonial;
                                  const totalAvailable =
                                    totalCapacity - totalUsed;

                                  // ✅ NO MOSTRAR hoteles sin habitaciones
                                  if (totalAvailable <= 0) return null;

                                  return (
                                    <option key={hotel.id} value={hotel.id}>
                                      {hotel.name} ({totalAvailable}{" "}
                                      habitaciones disponibles)
                                    </option>
                                  );
                                })}
                              </select>
                            </div>

                            {/* ✅ CAMBIO 6: Selección de tipo y cantidad de habitaciones MEJORADO */}
                            {passengerData.selectedHotel && (
                              <div className="mt-4 border-2 border-green-200 rounded-lg p-4 bg-green-50">
                                <h4 className="text-sm font-semibold text-slate-700 mb-3">
                                  Seleccionar Tipo y Cantidad de Habitaciones
                                </h4>

                                {(() => {
                                  const hotelId = parseInt(
                                    passengerData.selectedHotel,
                                  );
                                  const capacity = hotelCapacities[hotelId] || {
                                    simple: 0,
                                    doble: 0,
                                    matrimonial: 0,
                                  };

                                  // ✅ Calcular disponibilidad real usando usedRooms
                                  const usedGlobal = usedRooms[hotelId] || {
                                    simple: 0,
                                    doble: 0,
                                    matrimonial: 0,
                                  };

                                  // ✅ CALCULAR habitaciones ya seleccionadas en pasajeros temporales
                                  const usedInCurrentPassengers =
                                    multiplePassengers
                                      .filter(
                                        (p) =>
                                          parseInt(p.selectedHotel) === hotelId,
                                      )
                                      .reduce(
                                        (acc, p) => ({
                                          simple:
                                            acc.simple +
                                            (p.roomSelection?.simple || 0),
                                          doble:
                                            acc.doble +
                                            (p.roomSelection?.doble || 0),
                                          matrimonial:
                                            acc.matrimonial +
                                            (p.roomSelection?.matrimonial || 0),
                                        }),
                                        { simple: 0, doble: 0, matrimonial: 0 },
                                      );

                                  // ✅ Disponibilidad = Capacidad - Usadas globalmente - Usadas en pasajeros temporales
                                  const available = {
                                    simple: Math.max(
                                      0,
                                      capacity.simple -
                                        usedGlobal.simple -
                                        usedInCurrentPassengers.simple,
                                    ),
                                    doble: Math.max(
                                      0,
                                      capacity.doble -
                                        usedGlobal.doble -
                                        usedInCurrentPassengers.doble,
                                    ),
                                    matrimonial: Math.max(
                                      0,
                                      capacity.matrimonial -
                                        usedGlobal.matrimonial -
                                        usedInCurrentPassengers.matrimonial,
                                    ),
                                  };

                                  return (
                                    <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                      {/* Habitaciones Simples */}
                                      {capacity.simple > 0 && (
                                        <div className="bg-white rounded-lg p-3 border border-slate-200">
                                          <label className="block text-xs font-semibold text-slate-700 mb-2">
                                            Simples (Disponibles:{" "}
                                            {available.simple})
                                          </label>
                                          <input
                                            type="number"
                                            min="0"
                                            max={available.simple}
                                            value={
                                              passengerData.roomSelection
                                                ?.simple || 0
                                            }
                                            onChange={(e) => {
                                              const value =
                                                parseInt(e.target.value) || 0;
                                              setPassengerData({
                                                ...passengerData,
                                                roomSelection: {
                                                  ...passengerData.roomSelection,
                                                  simple: Math.min(
                                                    value,
                                                    available.simple,
                                                  ),
                                                },
                                              });
                                            }}
                                            disabled={available.simple === 0}
                                            className={`w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none text-center font-semibold ${
                                              available.simple === 0
                                                ? "bg-slate-100 cursor-not-allowed"
                                                : ""
                                            }`}
                                          />
                                          {available.simple === 0 && (
                                            <p className="text-xs text-red-600 mt-1 text-center font-semibold">
                                              ¡Agotado!
                                            </p>
                                          )}
                                        </div>
                                      )}

                                      {/* Habitaciones Dobles */}
                                      {capacity.doble > 0 && (
                                        <div className="bg-white rounded-lg p-3 border border-slate-200">
                                          <label className="block text-xs font-semibold text-slate-700 mb-2">
                                            Dobles (Disponibles:{" "}
                                            {available.doble})
                                          </label>
                                          <input
                                            type="number"
                                            min="0"
                                            max={available.doble}
                                            value={
                                              passengerData.roomSelection
                                                ?.doble || 0
                                            }
                                            onChange={(e) => {
                                              const value =
                                                parseInt(e.target.value) || 0;
                                              setPassengerData({
                                                ...passengerData,
                                                roomSelection: {
                                                  ...passengerData.roomSelection,
                                                  doble: Math.min(
                                                    value,
                                                    available.doble,
                                                  ),
                                                },
                                              });
                                            }}
                                            disabled={available.doble === 0}
                                            className={`w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none text-center font-semibold ${
                                              available.doble === 0
                                                ? "bg-slate-100 cursor-not-allowed"
                                                : ""
                                            }`}
                                          />
                                          {available.doble === 0 && (
                                            <p className="text-xs text-red-600 mt-1 text-center font-semibold">
                                              ¡Agotado!
                                            </p>
                                          )}
                                        </div>
                                      )}

                                      {/* Habitaciones Matrimoniales */}
                                      {capacity.matrimonial > 0 && (
                                        <div className="bg-white rounded-lg p-3 border border-slate-200">
                                          <label className="block text-xs font-semibold text-slate-700 mb-2">
                                            Matrimoniales (Disponibles:{" "}
                                            {available.matrimonial})
                                          </label>
                                          <input
                                            type="number"
                                            min="0"
                                            max={available.matrimonial}
                                            value={
                                              passengerData.roomSelection
                                                ?.matrimonial || 0
                                            }
                                            onChange={(e) => {
                                              const value =
                                                parseInt(e.target.value) || 0;
                                              setPassengerData({
                                                ...passengerData,
                                                roomSelection: {
                                                  ...passengerData.roomSelection,
                                                  matrimonial: Math.min(
                                                    value,
                                                    available.matrimonial,
                                                  ),
                                                },
                                              });
                                            }}
                                            disabled={
                                              available.matrimonial === 0
                                            }
                                            className={`w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none text-center font-semibold ${
                                              available.matrimonial === 0
                                                ? "bg-slate-100 cursor-not-allowed"
                                                : ""
                                            }`}
                                          />
                                          {available.matrimonial === 0 && (
                                            <p className="text-xs text-red-600 mt-1 text-center font-semibold">
                                              ¡Agotado!
                                            </p>
                                          )}
                                        </div>
                                      )}
                                    </div>
                                  );
                                })()}

                                {/* Servicios del hotel */}
                                <div className="mt-4 pt-4 border-t border-green-200">
                                  <p className="text-sm font-semibold text-slate-700 mb-3">
                                    Servicios del Hotel:
                                  </p>
                                  <div className="grid md:grid-cols-2 gap-3">
                                    {[
                                      { key: "desayuno", label: "Desayuno" },
                                      {
                                        key: "almuerzo",
                                        label: "Almuerzo / Comida",
                                      },
                                      { key: "snack", label: "Snack" },
                                      { key: "cena", label: "Cena" },
                                    ].map(({ key, label }) => (
                                      <button
                                        key={key}
                                        onClick={() =>
                                          setPassengerData({
                                            ...passengerData,
                                            hotelServices: {
                                              ...passengerData.hotelServices,
                                              [key]:
                                                !passengerData.hotelServices[
                                                  key
                                                ],
                                            },
                                          })
                                        }
                                        className="flex items-center gap-2 p-3 border-2 border-slate-300 rounded-lg hover:border-green-500 hover:bg-white transition"
                                      >
                                        {passengerData.hotelServices[key] ? (
                                          <CheckSquare className="w-5 h-5 text-green-600" />
                                        ) : (
                                          <Square className="w-5 h-5 text-slate-400" />
                                        )}
                                        <span className="text-sm font-medium text-slate-700">
                                          {label}
                                        </span>
                                      </button>
                                    ))}
                                  </div>
                                </div>
                              </div>
                            )}
                          </div>
                        )}

                        {/* Transporte */}
                        {enabledResources.transports.length > 0 && (
                          <div>
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                              Transporte
                            </label>
                            <div className="relative">
                              <Truck
                                className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                                size={20}
                              />
                              <select
                                value={passengerData.selectedTransport}
                                onChange={(e) =>
                                  setPassengerData({
                                    ...passengerData,
                                    selectedTransport: e.target.value,
                                  })
                                }
                                className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition appearance-none"
                              >
                                <option value="">
                                  Seleccione transporte...
                                </option>
                                {getAvailableTransportsForAgent().map(
                                  (transport) => (
                                    <option
                                      key={transport.id}
                                      value={transport.id}
                                    >
                                      {transport.name} - {transport.type}
                                    </option>
                                  ),
                                )}
                              </select>
                            </div>
                          </div>
                        )}

                        {/* Restaurante */}
                        {enabledResources.restaurants.length > 0 && (
                          <div>
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                              Restaurante
                            </label>
                            <div className="relative">
                              <Utensils
                                className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                                size={20}
                              />
                              <select
                                value={passengerData.selectedRestaurant}
                                onChange={(e) =>
                                  setPassengerData({
                                    ...passengerData,
                                    selectedRestaurant: e.target.value,
                                  })
                                }
                                className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition appearance-none"
                              >
                                <option value="">
                                  Seleccione restaurante...
                                </option>
                                {getAvailableRestaurantsForAgent().map(
                                  (restaurant) => (
                                    <option
                                      key={restaurant.id}
                                      value={restaurant.id}
                                    >
                                      {restaurant.name} - {restaurant.cuisine}
                                    </option>
                                  ),
                                )}
                              </select>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>

                    {/* Botones de acción */}
                    <div className="mt-8 flex flex-col sm:flex-row gap-3 sm:gap-4">
                      <button
                        onClick={handleGeneratePDF}
                        disabled={
                          isGeneratingPDF ||
                          multiplePassengers.length === 0 ||
                          !passengerData.emissionDate ||
                          !passengerData.emissionPlace
                        }
                        className="w-full sm:flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg transition flex items-center justify-center gap-2"
                      >
                        {isGeneratingPDF ? (
                          <>
                            <Loader2 className="animate-spin" size={20} />
                            Generando PDF...
                          </>
                        ) : (
                          <>
                            <Download size={20} />
                            Generar PDF ({multiplePassengers.length} pasajero
                            {multiplePassengers.length !== 1 ? "s" : ""})
                          </>
                        )}
                      </button>

                      <button
                        onClick={handleSendEmail}
                        disabled={
                          isSendingEmail ||
                          multiplePassengers.length === 0 ||
                          !passengerData.emissionDate ||
                          !passengerData.emissionPlace ||
                          (!passengerData.selectedHotel &&
                            !passengerData.selectedTransport &&
                            !passengerData.selectedRestaurant)
                        }
                        className="flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg transition flex items-center justify-center gap-2"
                      >
                        {isSendingEmail ? (
                          <>
                            <Loader2 className="animate-spin" size={20} />
                            Enviando...
                          </>
                        ) : emailSent ? (
                          <>
                            <Check size={20} />
                            ¡Enviado!
                          </>
                        ) : (
                          <>
                            <Send size={20} />
                            Generar y Enviar
                          </>
                        )}
                      </button>
                    </div>

                    {/* Mensajes de éxito */}
                    {saveSuccess && (
                      <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div className="flex items-center gap-2">
                          <Check className="text-blue-600" size={20} />
                          <p className="text-blue-800 font-semibold">
                            ¡PDF generado exitosamente para{" "}
                            {multiplePassengers.length} pasajero
                            {multiplePassengers.length !== 1 ? "s" : ""}!
                          </p>
                        </div>
                      </div>
                    )}

                    {emailSent && (
                      <div className="mt-4 bg-green-50 border border-green-200 rounded-lg p-4">
                        <div className="flex items-center gap-2">
                          <Check className="text-green-600" size={20} />
                          <div>
                            <p className="text-green-800 font-semibold">
                              ¡PDF generado y enviado exitosamente!
                            </p>
                            <p className="text-sm text-green-700 mt-1">
                              El voucher ha sido enviado a los proveedores
                              seleccionados
                            </p>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}

            {/* VISTA DE LÍNEA AÉREA - Con filtros mejorados */}
            {userRole === "airline" && (
              <div className="space-y-6">
                {/* Panel de filtros mejorados */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                    <div className="flex items-center gap-3">
                      <Filter className="w-6 h-6 text-purple-600" />
                      <h2 className="text-xl sm:text-2xl font-bold text-slate-800">
                        Filtros de Búsqueda
                      </h2>
                    </div>
                    <div className="flex flex-col sm:flex-row gap-2 lg:gap-3 w-full lg:w-auto">
                      <button
                        onClick={() => exportToExcel(filteredVouchers)}
                        disabled={filteredVouchers.length === 0}
                        className="flex items-center gap-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg transition"
                      >
                        <Download size={20} /> Exportar a Excel
                      </button>
                      <button
                        onClick={clearFilters}
                        className="flex items-center gap-2 bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded-lg transition w-full sm:w-auto"
                      >
                        <XCircle size={20} /> Limpiar Filtros
                      </button>
                    </div>
                  </div>
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4">
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Correlativo
                      </label>
                      <input
                        type="text"
                        value={filters.correlativo}
                        onChange={(e) =>
                          setFilters({
                            ...filters,
                            correlativo: e.target.value,
                          })
                        }
                        placeholder="Buscar correlativo..."
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        PNR
                      </label>
                      <input
                        type="text"
                        value={filters.pnr}
                        onChange={(e) =>
                          setFilters({ ...filters, pnr: e.target.value })
                        }
                        placeholder="Buscar PNR..."
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Pasajero
                      </label>
                      <input
                        type="text"
                        value={filters.passenger}
                        onChange={(e) =>
                          setFilters({ ...filters, passenger: e.target.value })
                        }
                        placeholder="Buscar pasajero..."
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Vuelo
                      </label>
                      <input
                        type="text"
                        value={filters.flight}
                        onChange={(e) =>
                          setFilters({ ...filters, flight: e.target.value })
                        }
                        placeholder="Buscar vuelo..."
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Hotel
                      </label>
                      <input
                        type="text"
                        value={filters.hotel}
                        onChange={(e) =>
                          setFilters({ ...filters, hotel: e.target.value })
                        }
                        placeholder="Buscar hotel..."
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Transporte
                      </label>
                      <input
                        type="text"
                        value={filters.transport}
                        onChange={(e) =>
                          setFilters({ ...filters, transport: e.target.value })
                        }
                        placeholder="Buscar transporte..."
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Restaurante
                      </label>
                      <input
                        type="text"
                        value={filters.restaurant}
                        onChange={(e) =>
                          setFilters({ ...filters, restaurant: e.target.value })
                        }
                        placeholder="Buscar restaurante..."
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Agente
                      </label>
                      <input
                        type="text"
                        value={filters.agent}
                        onChange={(e) =>
                          setFilters({ ...filters, agent: e.target.value })
                        }
                        placeholder="Buscar agente..."
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Fecha Desde
                      </label>
                      <input
                        type="date"
                        value={filters.dateFrom}
                        onChange={(e) =>
                          setFilters({ ...filters, dateFrom: e.target.value })
                        }
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Fecha Hasta
                      </label>
                      <input
                        type="date"
                        value={filters.dateTo}
                        onChange={(e) =>
                          setFilters({ ...filters, dateTo: e.target.value })
                        }
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none transition"
                      />
                    </div>
                  </div>
                </div>

                {/* Tabla de vouchers */}
                <div className="bg-white rounded-xl shadow-lg p-6">
                  <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                    <h2 className="text-xl sm:text-2xl font-bold text-slate-800">
                      Tickets Registrados
                    </h2>
                    <div className="bg-purple-100 px-4 py-2 rounded-lg">
                      <span className="text-purple-800 font-semibold">
                        {filteredVouchers.length} registro(s)
                      </span>
                    </div>
                  </div>
                  {filteredVouchers.length > 0 ? (
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead className="bg-purple-100">
                          <tr>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              #
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Correlativo
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              PNR
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Fecha Creación
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Fecha Actualización
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Generado por
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Fecha
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Pasajero
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Vuelo
                            </th>

                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Hotel
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Transporte
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Restaurante
                            </th>
                            {/* ✅ AGREGAR ESTA COLUMNA */}
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Monto Hotel
                            </th>
                            <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">
                              Estado
                            </th>
                            <th className="px-4 py-3 text-center text-sm font-semibold text-purple-900">
                              Acciones
                            </th>
                          </tr>
                        </thead>
                        <tbody className="divide-y divide-slate-200">
                          {filteredVouchers.map((voucher, index) => (
                            <tr
                              key={voucher.id}
                              className="hover:bg-purple-50 transition"
                            >
                              <td className="px-4 py-3 text-sm text-slate-600">
                                {index + 1}
                              </td>
                              <td className="px-4 py-3 text-sm font-mono text-slate-800 font-semibold">
                                {voucher.correlativo}
                              </td>
                              <td className="px-4 py-3 text-sm text-slate-600">
                                {voucher.pdfData?.passenger?.pnr || "N/A"}
                              </td>



                              {/* ✅ NUEVOS CAMPOS */}
                              <td className="px-4 py-3 text-sm text-slate-600">
                                {new Date(voucher.createdAt).toLocaleString(
                                  "es-PE",
                                  {
                                    year: "numeric",
                                    month: "2-digit",
                                    day: "2-digit",
                                    hour: "2-digit",
                                    minute: "2-digit",
                                  },
                                )}
                              </td>
                              <td className="px-4 py-3 text-sm text-slate-600">
                                {new Date(voucher.updatedAt).toLocaleString(
                                  "es-PE",
                                  {
                                    year: "numeric",
                                    month: "2-digit",
                                    day: "2-digit",
                                    hour: "2-digit",
                                    minute: "2-digit",
                                  },
                                )}
                              </td>

                              <td className="px-4 py-3 text-sm text-slate-600 font-semibold">
                                {voucher.generatedBy}
                              </td>

                              <td className="px-4 py-3 text-sm text-slate-600">
                                {voucher.date}
                              </td>
                              <td className="px-4 py-3 text-sm text-slate-600">
                                {voucher.passenger}
                              </td>
                              <td className="px-4 py-3 text-sm text-slate-600">
                                {voucher.flight}
                              </td>

                              <td className="px-4 py-3 text-sm text-slate-600">
                                {voucher.pdfData?.hotel?.name || "N/A"}
                              </td>
                              <td className="px-4 py-3 text-sm text-slate-600">
                                {voucher.pdfData?.transport?.name || "N/A"}
                              </td>
                              <td className="px-4 py-3 text-sm text-slate-600">
                                {voucher.pdfData?.restaurant?.name || "N/A"}
                              </td>

                              {/* ✅ AGREGAR ESTA CELDA */}
                              <td className="px-4 py-3 text-sm font-bold text-green-700">
                                {voucher.hotelCost > 0 
                                  ? `S/ ${voucher.hotelCost.toFixed(2)}` 
                                  : "S/ 0.00"}
                              </td>
                              <td className="px-4 py-3">
                                <span className="px-3 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">
                                  Activo
                                </span>
                              </td>
                              <td className="px-4 py-3 text-center">
                                <button
                                  onClick={() =>
                                    handleViewVoucherDetail(voucher)
                                  }
                                  className="text-purple-600 hover:text-purple-800 hover:underline font-semibold text-sm transition"
                                >
                                  detalle
                                </button>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  ) : (
                    <div className="text-center py-12">
                      <FileText className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                      <p className="text-slate-600">
                        {registeredVouchers.length === 0
                          ? "No hay vouchers registrados aún"
                          : "No se encontraron resultados con los filtros aplicados"}
                      </p>
                    </div>
                  )}
                </div>
              </div>
            )}

            {/* VISTA DEL ADMINISTRADOR - Gestión de proveedores con filtro */}
            
           {userRole === "admin" && (
              <div className="space-y-6">
                {/* ========================================
        DASHBOARD DEL ADMINISTRADOR
        ======================================== */}
                {adminView === "dashboard" && (
                  <div className="max-w-4xl mx-auto">
                    <div className="bg-white rounded-xl shadow-lg p-8 mb-6">
                      <div className="text-center mb-8">
                        <div className="bg-orange-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                          <Building className="w-10 h-10 text-orange-600" />
                        </div>
                        <h2 className="text-3xl font-bold text-slate-800 mb-2">
                          Panel de Administración
                        </h2>
                        <p className="text-slate-600">
                          Gestiona proveedores y usuarios del sistema
                        </p>
                      </div>

                      <div className="grid md:grid-cols-2 gap-6">
                        {/* Tarjeta Gestión de Proveedores */}
                        <button
                          onClick={() => setAdminView("providers")}
                          className="group bg-gradient-to-br from-orange-50 to-red-50 hover:from-orange-100 hover:to-red-100 border-2 border-orange-200 hover:border-orange-400 rounded-xl p-8 transition-all duration-300 hover:shadow-xl"
                        >
                          <div className="flex flex-col items-center text-center">
                            <div className="bg-orange-600 group-hover:bg-orange-700 w-16 h-16 rounded-full flex items-center justify-center mb-4 transition-colors">
                              <Building2 className="w-8 h-8 text-white" />
                            </div>
                            <h3 className="text-xl font-bold text-slate-800 mb-2">
                              Gestión de Proveedores
                            </h3>
                            <p className="text-slate-600 mb-4">
                              Administra hoteles, transportes y restaurantes
                            </p>
                            <div className="flex items-center gap-2 text-orange-600 font-semibold">
                              <span>Acceder</span>
                              <ArrowLeft className="w-5 h-5 rotate-180 group-hover:translate-x-1 transition-transform" />
                            </div>
                          </div>
                        </button>

                        {/* Tarjeta Gestión de Usuarios */}
                        <button
                          onClick={() => setAdminView("users")}
                          className="group bg-gradient-to-br from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 border-2 border-blue-200 hover:border-blue-400 rounded-xl p-8 transition-all duration-300 hover:shadow-xl"
                        >
                          <div className="flex flex-col items-center text-center">
                            <div className="bg-blue-600 group-hover:bg-blue-700 w-16 h-16 rounded-full flex items-center justify-center mb-4 transition-colors">
                              <Users className="w-8 h-8 text-white" />
                            </div>
                            <h3 className="text-xl font-bold text-slate-800 mb-2">
                              Gestión de Usuarios
                            </h3>
                            <p className="text-slate-600 mb-4">
                              Administra usuarios y roles del sistema
                            </p>
                            <div className="flex items-center gap-2 text-blue-600 font-semibold">
                              <span>Acceder</span>
                              <ArrowLeft className="w-5 h-5 rotate-180 group-hover:translate-x-1 transition-transform" />
                            </div>
                          </div>
                        </button>
                      </div>
                    </div>

                    {/* Estadísticas rápidas */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      <div className="bg-white rounded-lg shadow p-4 border-l-4 border-orange-500">
                        <p className="text-slate-600 text-sm font-medium mb-1">
                          Proveedores
                        </p>
                        <p className="text-2xl font-bold text-slate-800">
                          {registeredCompanies.length}
                        </p>
                      </div>
                      <div className="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500">
                        <p className="text-slate-600 text-sm font-medium mb-1">
                          Usuarios
                        </p>
                        <p className="text-2xl font-bold text-slate-800">
                          {users.length}
                        </p>
                      </div>
                      <div className="bg-white rounded-lg shadow p-4 border-l-4 border-green-500">
                        <p className="text-slate-600 text-sm font-medium mb-1">
                          Activos
                        </p>
                        <p className="text-2xl font-bold text-slate-800">
                          {users.filter((u) => u.estado === "activo").length}
                        </p>
                      </div>
                      <div className="bg-white rounded-lg shadow p-4 border-l-4 border-purple-500">
                        <p className="text-slate-600 text-sm font-medium mb-1">
                          Vouchers
                        </p>
                        <p className="text-2xl font-bold text-slate-800">
                          {registeredVouchers.length}
                        </p>
                      </div>
                    </div>
                  </div>
                )}

                {/* ========================================
        GESTIÓN DE USUARIOS
        ======================================== */}
                {adminView === "users" && (
                  <div className="space-y-6">
                    {/* Botón volver */}
                    <button
                      onClick={() => setAdminView("dashboard")}
                      className="flex items-center gap-2 bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded-lg transition"
                    >
                      <ArrowLeft size={20} />
                      Volver al Dashboard
                    </button>

                    {/* Formulario de registro/edición de usuario */}
                    <div className="bg-white rounded-xl shadow-lg p-4 sm:p-8">
                      <div className="flex items-center gap-3 mb-6">
                        <div className="bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center">
                          <Users className="w-6 h-6 text-blue-600" />
                        </div>
                        <div>
                          <h2 className="text-xl sm:text-2xl font-bold text-slate-800">
                            {editingUserId
                              ? "Editar Usuario"
                              : "Registro de Usuarios"}
                          </h2>
                          <p className="text-slate-600">
                            Gestiona los usuarios del sistema
                          </p>
                        </div>
                      </div>

                      {editingUserId && (
                        <div className="mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                            <div className="flex items-center gap-2">
                              <AlertCircle
                                className="text-blue-600 flex-shrink-0"
                                size={20}
                              />
                              <p className="text-blue-800 font-semibold">
                                Modo de edición activo
                              </p>
                            </div>
                            <button
                              onClick={() => {
                                setEditingUserId(null);
                                setUserData({
                                  nombre: "",
                                  email: "",
                                  telefono: "",
                                  rol: "",
                                  estado: "activo",
                                  codigoEmpleado: "",
                                  password: "",
                                });
                              }}
                              className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition w-full sm:w-auto justify-center"
                            >
                              <X size={16} /> Cancelar Edición
                            </button>
                          </div>
                        </div>
                      )}

                      <div className="grid md:grid-cols-2 gap-6">
                        {/* Nombre Completo */}
                        <div className="md:col-span-2">
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Nombre Completo *
                          </label>
                          <div className="relative">
                            <User
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="text"
                              value={userData.nombre}
                              onChange={(e) =>
                                setUserData({
                                  ...userData,
                                  nombre: e.target.value,
                                })
                              }
                              placeholder="Ej. Juan Pérez"
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
                            />
                          </div>
                        </div>

                        {/* Correo Electrónico */}
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Correo Electrónico *
                          </label>
                          <div className="relative">
                            <Mail
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="email"
                              value={userData.email}
                              onChange={(e) =>
                                setUserData({
                                  ...userData,
                                  email: e.target.value,
                                })
                              }
                              placeholder="usuario@plusultra.com"
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
                            />
                          </div>
                        </div>

                        {/* Teléfono */}
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Teléfono
                          </label>
                          <div className="relative">
                            <Phone
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="tel"
                              value={userData.telefono}
                              onChange={(e) =>
                                setUserData({
                                  ...userData,
                                  telefono: e.target.value,
                                })
                              }
                              placeholder="+51 987 654 321"
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
                            />
                          </div>
                        </div>

                        {/* Código de Empleado */}
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Código de Empleado *
                          </label>
                          <div className="relative">
                            <FileText
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="text"
                              value={userData.codigoEmpleado}
                              onChange={(e) =>
                                setUserData({
                                  ...userData,
                                  codigoEmpleado: e.target.value,
                                })
                              }
                              placeholder="EMP001"
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
                            />
                          </div>
                        </div>

                        {/* Rol */}
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Rol *
                          </label>
                          <select
                            value={userData.rol}
                            onChange={(e) =>
                              setUserData({ ...userData, rol: e.target.value })
                            }
                            className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
                          >
                            <option value="">Seleccione un rol...</option>
                            <option value="airportLeader">
                              Líder Aeroportuario
                            </option>
                            <option value="agent">Agente</option>
                            <option value="airline">Línea Aérea</option>
                            <option value="admin">Administrador</option>
                          </select>
                        </div>

                        {/* Contraseña (solo al crear) */}
                        {!editingUserId && (
                          <div className="md:col-span-2">
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                              Contraseña *
                            </label>
                            <div className="relative">
                              <Lock
                                className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                                size={20}
                              />
                              <input
                                type={showPassword ? "text" : "password"}
                                value={userData.password}
                                onChange={(e) =>
                                  setUserData({
                                    ...userData,
                                    password: e.target.value,
                                  })
                                }
                                placeholder="••••••••"
                                className="w-full pl-10 pr-12 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
                              />
                              <button
                                onClick={() => setShowPassword(!showPassword)}
                                className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition"
                              >
                                {showPassword ? (
                                  <EyeOff size={20} />
                                ) : (
                                  <Eye size={20} />
                                )}
                              </button>
                            </div>
                          </div>
                        )}

                        {/* Estado */}
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Estado *
                          </label>
                          <select
                            value={userData.estado}
                            onChange={(e) =>
                              setUserData({
                                ...userData,
                                estado: e.target.value,
                              })
                            }
                            className="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
                          >
                            <option value="activo">Activo</option>
                            <option value="inactivo">Inactivo</option>
                          </select>
                        </div>
                      </div>

                      {/* Botones de acción */}
                      <div className="mt-8 flex flex-col sm:flex-row gap-4">
                        <button
                          onClick={handleSaveUser}
                          disabled={
                            isSaving ||
                            !userData.nombre ||
                            !userData.email ||
                            !userData.rol ||
                            !userData.codigoEmpleado ||
                            (!editingUserId && !userData.password)
                          }
                          className="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg transition flex items-center justify-center gap-2"
                        >
                          {isSaving ? (
                            <>
                              <Loader2 className="animate-spin" size={20} />
                              {editingUserId
                                ? "Actualizando..."
                                : "Guardando..."}
                            </>
                          ) : saveSuccess ? (
                            <>
                              <Check size={20} />
                              {editingUserId
                                ? "Actualizado"
                                : "Guardado Exitoso"}
                            </>
                          ) : editingUserId ? (
                            "Actualizar Usuario"
                          ) : (
                            "Registrar Usuario"
                          )}
                        </button>
                        <button
                          onClick={() => {
                            setEditingUserId(null);
                            setUserData({
                              nombre: "",
                              email: "",
                              telefono: "",
                              rol: "",
                              estado: "activo",
                              codigoEmpleado: "",
                              password: "",
                            });
                          }}
                          className="px-6 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-3 rounded-lg transition"
                        >
                          Limpiar
                        </button>
                      </div>

                      {saveSuccess && (
                        <div className="mt-4 bg-green-50 border border-green-200 rounded-lg p-4">
                          <div className="flex items-center gap-2">
                            <Check className="text-green-600" size={20} />
                            <p className="text-green-800 font-semibold">
                              {editingUserId
                                ? "¡Usuario actualizado exitosamente!"
                                : "¡Usuario registrado exitosamente!"}
                            </p>
                          </div>
                        </div>
                      )}
                    </div>

                    {/* Lista de usuarios */}
                    <div className="bg-white rounded-xl shadow-lg p-4 sm:p-8">
                      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                        <h2 className="text-xl sm:text-2xl font-bold text-slate-800">
                          Usuarios Registrados (
                          {
                            users.filter((u) => {
                              if (!userSearchFilter) return true;
                              const search = userSearchFilter.toLowerCase();
                              return (
                                u.nombre.toLowerCase().includes(search) ||
                                u.email.toLowerCase().includes(search) ||
                                u.codigoEmpleado
                                  .toLowerCase()
                                  .includes(search) ||
                                getRoleInfo(u.rol)
                                  .label.toLowerCase()
                                  .includes(search)
                              );
                            }).length
                          }
                          )
                        </h2>

                        {/* Buscador */}
                        <div className="relative w-full sm:w-auto sm:min-w-[300px]">
                          <Filter
                            className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                            size={18}
                          />
                          <input
                            type="text"
                            value={userSearchFilter}
                            onChange={(e) =>
                              setUserSearchFilter(e.target.value)
                            }
                            placeholder="Buscar por nombre, email, código..."
                            className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition text-sm"
                          />
                        </div>
                      </div>

                      {users.filter((u) => {
                        if (!userSearchFilter) return true;
                        const search = userSearchFilter.toLowerCase();
                        return (
                          u.nombre.toLowerCase().includes(search) ||
                          u.email.toLowerCase().includes(search) ||
                          u.codigoEmpleado.toLowerCase().includes(search) ||
                          getRoleInfo(u.rol)
                            .label.toLowerCase()
                            .includes(search)
                        );
                      }).length > 0 ? (
                        <div className="space-y-4">
                          {users
                            .filter((u) => {
                              if (!userSearchFilter) return true;
                              const search = userSearchFilter.toLowerCase();
                              return (
                                u.nombre.toLowerCase().includes(search) ||
                                u.email.toLowerCase().includes(search) ||
                                u.codigoEmpleado
                                  .toLowerCase()
                                  .includes(search) ||
                                getRoleInfo(u.rol)
                                  .label.toLowerCase()
                                  .includes(search)
                              );
                            })
                            .map((user) => {
                              const roleInfo = getRoleInfo(user.rol);
                              return (
                                <div
                                  key={user.id}
                                  className={`border rounded-lg p-4 sm:p-6 transition ${
                                    user.estado === "activo"
                                      ? "border-slate-200 bg-white hover:shadow-md"
                                      : "border-slate-300 bg-slate-100 opacity-60"
                                  }`}
                                >
                                  {/* Header del usuario */}
                                  <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 mb-4">
                                    <div className="flex items-start gap-3 sm:gap-4 flex-1">
                                      {/* Avatar */}
                                      <div
                                        className={`${user.estado === "activo" ? `bg-${roleInfo.color}-100` : "bg-slate-200"} w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0`}
                                      >
                                        <User
                                          className={
                                            user.estado === "activo"
                                              ? `text-${roleInfo.color}-600`
                                              : "text-slate-400"
                                          }
                                          size={24}
                                        />
                                      </div>

                                      {/* Información */}
                                      <div className="flex-1 min-w-0">
                                        <h3
                                          className={`text-lg sm:text-xl font-bold mb-1 break-words ${user.estado === "activo" ? "text-slate-800" : "text-slate-500"}`}
                                        >
                                          {user.nombre}
                                        </h3>

                                        {/* Badges */}
                                        <div className="flex flex-wrap items-center gap-2 mb-3">
                                          <span
                                            className={`inline-block px-3 py-1 text-xs font-semibold rounded-full ${
                                              user.estado === "activo"
                                                ? `bg-${roleInfo.color}-100 text-${roleInfo.color}-700`
                                                : "bg-slate-200 text-slate-600"
                                            }`}
                                          >
                                            {roleInfo.label}
                                          </span>
                                          <span
                                            className={`inline-block px-3 py-1 text-xs font-semibold rounded-full ${
                                              user.estado === "activo"
                                                ? "bg-green-100 text-green-700"
                                                : "bg-red-100 text-red-700"
                                            }`}
                                          >
                                            {user.estado === "activo"
                                              ? "Activo"
                                              : "Inactivo"}
                                          </span>
                                        </div>
                                      </div>
                                    </div>

                                    {/* Botones de acción */}
                                    <div className="flex gap-2">
                                      <button
                                        onClick={() => {
                                          setEditingUserId(user.id);
                                          setUserData({
                                            nombre: user.nombre,
                                            email: user.email,
                                            telefono: user.telefono || "",
                                            rol: user.rol,
                                            estado: user.estado,
                                            codigoEmpleado: user.codigoEmpleado,
                                            password: "",
                                          });
                                          window.scrollTo({
                                            top: 0,
                                            behavior: "smooth",
                                          });
                                        }}
                                        className="p-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition"
                                        title="Editar usuario"
                                      >
                                        <Edit size={20} />
                                      </button>

                                      <button
                                        onClick={() => {
                                          setUsers(
                                            users.map((u) =>
                                              u.id === user.id
                                                ? {
                                                    ...u,
                                                    estado:
                                                      u.estado === "activo"
                                                        ? "inactivo"
                                                        : "activo",
                                                  }
                                                : u,
                                            ),
                                          );
                                        }}
                                        className={`p-2 rounded-lg transition ${
                                          user.estado === "activo"
                                            ? "bg-yellow-100 hover:bg-yellow-200 text-yellow-700"
                                            : "bg-green-100 hover:bg-green-200 text-green-700"
                                        }`}
                                        title={
                                          user.estado === "activo"
                                            ? "Desactivar"
                                            : "Activar"
                                        }
                                      >
                                        {user.estado === "activo" ? (
                                          <EyeOff size={20} />
                                        ) : (
                                          <Eye size={20} />
                                        )}
                                      </button>
                                    </div>
                                  </div>

                                  {/* Detalles del usuario */}
                                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                                    <div className="flex items-center gap-2">
                                      <Mail
                                        className={
                                          user.estado === "activo"
                                            ? "text-slate-400"
                                            : "text-slate-300"
                                        }
                                        size={16}
                                      />
                                      <span
                                        className={`break-all ${user.estado === "activo" ? "text-slate-600" : "text-slate-400"}`}
                                      >
                                        {user.email}
                                      </span>
                                    </div>

                                    {user.telefono && (
                                      <div className="flex items-center gap-2">
                                        <Phone
                                          className={
                                            user.estado === "activo"
                                              ? "text-slate-400"
                                              : "text-slate-300"
                                          }
                                          size={16}
                                        />
                                        <span
                                          className={
                                            user.estado === "activo"
                                              ? "text-slate-600"
                                              : "text-slate-400"
                                          }
                                        >
                                          {user.telefono}
                                        </span>
                                      </div>
                                    )}

                                    <div className="flex items-center gap-2">
                                      <FileText
                                        className={
                                          user.estado === "activo"
                                            ? "text-slate-400"
                                            : "text-slate-300"
                                        }
                                        size={16}
                                      />
                                      <span
                                        className={
                                          user.estado === "activo"
                                            ? "text-slate-600"
                                            : "text-slate-400"
                                        }
                                      >
                                        <span className="font-semibold">
                                          Código:
                                        </span>{" "}
                                        {user.codigoEmpleado}
                                      </span>
                                    </div>

                                    <div className="flex items-center gap-2">
                                      <Calendar
                                        className={
                                          user.estado === "activo"
                                            ? "text-slate-400"
                                            : "text-slate-300"
                                        }
                                        size={16}
                                      />
                                      <span
                                        className={
                                          user.estado === "activo"
                                            ? "text-slate-600"
                                            : "text-slate-400"
                                        }
                                      >
                                        <span className="font-semibold">
                                          Registro:
                                        </span>{" "}
                                        {user.fechaRegistro}
                                      </span>
                                    </div>
                                  </div>
                                </div>
                              );
                            })}
                        </div>
                      ) : (
                        <div className="text-center py-12">
                          <Users className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                          <p className="text-slate-600">
                            {users.length === 0
                              ? "No hay usuarios registrados aún"
                              : "No se encontraron resultados con el filtro aplicado"}
                          </p>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* ========================================
        GESTIÓN DE PROVEEDORES (CÓDIGO EXISTENTE)
        ======================================== */}
                {adminView === "providers" && (
                  <div className="space-y-6">
                    {/* Botón volver */}
                    <button
                      onClick={() => setAdminView("dashboard")}
                      className="flex items-center gap-2 bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded-lg transition"
                    >
                      <ArrowLeft size={20} />
                      Volver al Dashboard
                    </button>

                    {/* Formulario de registro/edición de proveedor */}
                    <div className="bg-white rounded-xl shadow-lg p-4 sm:p-8">
                      <div className="flex items-center gap-3 mb-6">
                        <div className="bg-orange-100 w-12 h-12 rounded-full flex items-center justify-center">
                          <Building className="w-6 h-6 text-orange-600" />
                        </div>
                        <div>
                          <h2 className="text-xl sm:text-2xl font-bold text-slate-800">
                            {editingCompanyId
                              ? "Editar Proveedor"
                              : "Registro de Proveedores"}
                          </h2>
                          <p className="text-slate-600">
                            Gestione los proveedores de servicios (Master Data)
                          </p>
                        </div>
                      </div>

                      {editingCompanyId && (
                        <div className="mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                            <div className="flex items-center gap-2">
                              <AlertCircle
                                className="text-blue-600"
                                size={20}
                              />
                              <p className="text-blue-800 font-semibold">
                                Modo de edición activo
                              </p>
                            </div>
                            <button
                              onClick={() => {
                                setEditingCompanyId(null);
                                setCompanyData({
                                  razonSocial: "",
                                  ruc: "",
                                  direccion: "",
                                  tipoEmpresa: "",
                                  telefono: "",
                                  email: "",
                                });
                              }}
                              className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition w-full sm:w-auto justify-center"
                            >
                              <X size={16} /> Cancelar Edición
                            </button>
                          </div>
                        </div>
                      )}

                      <div className="grid md:grid-cols-2 gap-6">
                        <div className="md:col-span-2">
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Razón Social *
                          </label>
                          <div className="relative">
                            <Building2
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="text"
                              value={companyData.razonSocial}
                              onChange={(e) =>
                                setCompanyData({
                                  ...companyData,
                                  razonSocial: e.target.value,
                                })
                              }
                              placeholder="Nombre de la empresa"
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none transition"
                            />
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            RUC *
                          </label>
                          <div className="relative">
                            <FileText
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="text"
                              value={companyData.ruc}
                              onChange={(e) =>
                                setCompanyData({
                                  ...companyData,
                                  ruc: e.target.value,
                                })
                              }
                              placeholder="20123456789"
                              maxLength={11}
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none transition"
                            />
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Tipo de Proveedor *
                          </label>
                          <select
                            value={companyData.tipoEmpresa}
                            onChange={(e) =>
                              setCompanyData({
                                ...companyData,
                                tipoEmpresa: e.target.value,
                              })
                            }
                            className="w-full px-4 py-3 min-h-[44px] border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none transition"
                          >
                            <option value="">Seleccione...</option>
                            <option value="transporte">Transporte</option>
                            <option value="hospedaje">Hospedaje</option>
                            <option value="alimentacion">Alimentación</option>
                          </select>
                        </div>
                        <div className="md:col-span-2">
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Dirección *
                          </label>
                          <div className="relative">
                            <MapPin
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="text"
                              value={companyData.direccion}
                              onChange={(e) =>
                                setCompanyData({
                                  ...companyData,
                                  direccion: e.target.value,
                                })
                              }
                              placeholder="Dirección completa"
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none transition"
                            />
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Teléfono
                          </label>
                          <div className="relative">
                            <Phone
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="tel"
                              value={companyData.telefono}
                              onChange={(e) =>
                                setCompanyData({
                                  ...companyData,
                                  telefono: e.target.value,
                                })
                              }
                              placeholder="+51 1 234 5678"
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none transition"
                            />
                          </div>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-slate-700 mb-2">
                            Correo Electrónico
                          </label>
                          <div className="relative">
                            <Mail
                              className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                              size={20}
                            />
                            <input
                              type="email"
                              value={companyData.email}
                              onChange={(e) =>
                                setCompanyData({
                                  ...companyData,
                                  email: e.target.value,
                                })
                              }
                              placeholder="contacto@empresa.com"
                              className="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none transition"
                            />
                          </div>
                        </div>
                      </div>

                      <div className="mt-8 flex gap-4">
                        <button
                          onClick={handleSaveCompany}
                          disabled={
                            isSaving ||
                            !companyData.razonSocial ||
                            !companyData.ruc ||
                            !companyData.tipoEmpresa ||
                            !companyData.direccion
                          }
                          className="flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg transition flex items-center justify-center gap-2"
                        >
                          {isSaving ? (
                            <>
                              <Loader2 className="animate-spin" size={20} />
                              {editingCompanyId
                                ? "Actualizando..."
                                : "Guardando..."}
                            </>
                          ) : saveSuccess ? (
                            <>
                              <Check size={20} />
                              {editingCompanyId
                                ? "Actualizado"
                                : "Guardado Exitoso"}
                            </>
                          ) : editingCompanyId ? (
                            "Actualizar Proveedor"
                          ) : (
                            "Registrar Proveedor"
                          )}
                        </button>
                        <button
                          onClick={() => {
                            setEditingCompanyId(null);
                            setCompanyData({
                              razonSocial: "",
                              ruc: "",
                              direccion: "",
                              tipoEmpresa: "",
                              telefono: "",
                              email: "",
                            });
                          }}
                          className="px-6 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-3 rounded-lg transition"
                        >
                          Limpiar
                        </button>
                      </div>

                      {saveSuccess && (
                        <div className="mt-4 bg-green-50 border border-green-200 rounded-lg p-4">
                          <div className="flex items-center gap-2">
                            <Check className="text-green-600" size={20} />
                            <p className="text-green-800 font-semibold">
                              {editingCompanyId
                                ? "¡Proveedor actualizado! Los cambios están disponibles para todos los roles."
                                : "¡Proveedor registrado! Ahora está disponible en las listas de selección."}
                            </p>
                          </div>
                        </div>
                      )}
                    </div>

                    {/* Lista de proveedores registrados CON FILTRO */}
                    <div className="bg-white rounded-xl shadow-lg p-8">
                      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                        <h2 className="text-xl sm:text-2xl font-bold text-slate-800">
                          Proveedores Registrados (
                          {
                            registeredCompanies.filter((company) => {
                              if (
                                !filters.hotel &&
                                !filters.transport &&
                                !filters.restaurant
                              )
                                return true;
                              if (
                                filters.hotel &&
                                company.tipoEmpresa === "hospedaje" &&
                                company.razonSocial
                                  .toLowerCase()
                                  .includes(filters.hotel.toLowerCase())
                              )
                                return true;
                              if (
                                filters.transport &&
                                company.tipoEmpresa === "transporte" &&
                                company.razonSocial
                                  .toLowerCase()
                                  .includes(filters.transport.toLowerCase())
                              )
                                return true;
                              if (
                                filters.restaurant &&
                                company.tipoEmpresa === "alimentacion" &&
                                company.razonSocial
                                  .toLowerCase()
                                  .includes(filters.restaurant.toLowerCase())
                              )
                                return true;
                              return false;
                            }).length
                          }
                          )
                        </h2>
                        <button
                          onClick={() =>
                            setFilters({
                              ...filters,
                              hotel: "",
                              transport: "",
                              restaurant: "",
                            })
                          }
                          className="flex items-center gap-2 bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded-lg transition w-full sm:w-auto"
                        >
                          <XCircle size={20} /> Limpiar Filtros
                        </button>
                      </div>

                      {/* Panel de filtros */}
                      <div className="mb-6 bg-slate-50 rounded-lg p-4 border border-slate-200">
                        <div className="flex items-center gap-3 mb-4">
                          <Filter className="w-5 h-5 text-orange-600" />
                          <h3 className="text-base sm:text-lg font-semibold text-slate-800">
                            Filtrar por tipo de proveedor
                          </h3>
                        </div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                          <div>
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                              Hospedaje
                            </label>
                            <div className="relative">
                              <Hotel
                                className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                                size={18}
                              />
                              <input
                                type="text"
                                value={filters.hotel}
                                onChange={(e) =>
                                  setFilters({
                                    ...filters,
                                    hotel: e.target.value,
                                  })
                                }
                                placeholder="Buscar hotel..."
                                className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none transition"
                              />
                            </div>
                          </div>
                          <div>
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                              Transporte
                            </label>
                            <div className="relative">
                              <Truck
                                className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                                size={18}
                              />
                              <input
                                type="text"
                                value={filters.transport}
                                onChange={(e) =>
                                  setFilters({
                                    ...filters,
                                    transport: e.target.value,
                                  })
                                }
                                placeholder="Buscar transporte..."
                                className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none transition"
                              />
                            </div>
                          </div>
                          <div>
                            <label className="block text-sm font-medium text-slate-700 mb-2">
                              Alimentación
                            </label>
                            <div className="relative">
                              <Utensils
                                className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
                                size={18}
                              />
                              <input
                                type="text"
                                value={filters.restaurant}
                                onChange={(e) =>
                                  setFilters({
                                    ...filters,
                                    restaurant: e.target.value,
                                  })
                                }
                                placeholder="Buscar restaurante..."
                                className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none transition"
                              />
                            </div>
                          </div>
                        </div>
                      </div>

                      {registeredCompanies.filter((company) => {
                        if (
                          !filters.hotel &&
                          !filters.transport &&
                          !filters.restaurant
                        )
                          return true;
                        if (
                          filters.hotel &&
                          company.tipoEmpresa === "hospedaje" &&
                          company.razonSocial
                            .toLowerCase()
                            .includes(filters.hotel.toLowerCase())
                        )
                          return true;
                        if (
                          filters.transport &&
                          company.tipoEmpresa === "transporte" &&
                          company.razonSocial
                            .toLowerCase()
                            .includes(filters.transport.toLowerCase())
                        )
                          return true;
                        if (
                          filters.restaurant &&
                          company.tipoEmpresa === "alimentacion" &&
                          company.razonSocial
                            .toLowerCase()
                            .includes(filters.restaurant.toLowerCase())
                        )
                          return true;
                        return false;
                      }).length > 0 ? (
                        <div className="space-y-4">
                          {registeredCompanies
                            .filter((company) => {
                              if (
                                !filters.hotel &&
                                !filters.transport &&
                                !filters.restaurant
                              )
                                return true;
                              if (
                                filters.hotel &&
                                company.tipoEmpresa === "hospedaje" &&
                                company.razonSocial
                                  .toLowerCase()
                                  .includes(filters.hotel.toLowerCase())
                              )
                                return true;
                              if (
                                filters.transport &&
                                company.tipoEmpresa === "transporte" &&
                                company.razonSocial
                                  .toLowerCase()
                                  .includes(filters.transport.toLowerCase())
                              )
                                return true;
                              if (
                                filters.restaurant &&
                                company.tipoEmpresa === "alimentacion" &&
                                company.razonSocial
                                  .toLowerCase()
                                  .includes(filters.restaurant.toLowerCase())
                              )
                                return true;
                              return false;
                            })
                            .map((company) => (
                              <div
                                key={company.id}
                                className={`border rounded-lg p-4 sm:p-6 transition ${
                                  company.activo
                                    ? "border-slate-200 bg-white hover:shadow-md"
                                    : "border-slate-300 bg-slate-100 opacity-60"
                                }`}
                              >
                                {/* Header del proveedor con iconos y badges */}
                                <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 mb-4">
                                  <div className="flex items-start gap-3 sm:gap-4 flex-1">
                                    {/* Icono del tipo de proveedor */}
                                    <div
                                      className={`${
                                        company.activo
                                          ? `bg-${getTipoEmpresaColor(company.tipoEmpresa)}-100`
                                          : "bg-slate-200"
                                      } w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0`}
                                    >
                                      <span
                                        className={
                                          company.activo
                                            ? `text-${getTipoEmpresaColor(company.tipoEmpresa)}-600`
                                            : "text-slate-400"
                                        }
                                      >
                                        {getTipoEmpresaIcon(
                                          company.tipoEmpresa,
                                        )}
                                      </span>
                                    </div>

                                    {/* Información principal */}
                                    <div className="flex-1 min-w-0">
                                      <h3
                                        className={`text-lg sm:text-xl font-bold mb-1 break-words ${
                                          company.activo
                                            ? "text-slate-800"
                                            : "text-slate-500"
                                        }`}
                                      >
                                        {company.razonSocial}
                                      </h3>

                                      {/* Badges de tipo y estado */}
                                      <div className="flex flex-wrap items-center gap-2 mb-3">
                                        <span
                                          className={`inline-block px-3 py-1 text-xs font-semibold rounded-full ${
                                            company.activo
                                              ? `bg-${getTipoEmpresaColor(company.tipoEmpresa)}-100 text-${getTipoEmpresaColor(company.tipoEmpresa)}-700`
                                              : "bg-slate-200 text-slate-600"
                                          }`}
                                        >
                                          {getTipoEmpresaLabel(
                                            company.tipoEmpresa,
                                          )}
                                        </span>
                                        <span
                                          className={`inline-block px-3 py-1 text-xs font-semibold rounded-full ${
                                            company.activo
                                              ? "bg-green-100 text-green-700"
                                              : "bg-red-100 text-red-700"
                                          }`}
                                        >
                                          {company.activo
                                            ? "Activo"
                                            : "Desactivado"}
                                        </span>
                                      </div>
                                    </div>
                                  </div>

                                  {/* Botones de acción: Editar y Activar/Desactivar */}
                                  <div className="flex gap-2">
                                    {/* Botón de Editar */}
                                    <button
                                      onClick={() => {
                                        setEditingCompanyId(company.id);
                                        setCompanyData({
                                          razonSocial: company.razonSocial,
                                          ruc: company.ruc,
                                          direccion: company.direccion,
                                          tipoEmpresa: company.tipoEmpresa,
                                          telefono: company.telefono || "",
                                          email: company.email || "",
                                        });
                                        window.scrollTo({
                                          top: 0,
                                          behavior: "smooth",
                                        });
                                      }}
                                      className="p-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition"
                                      title="Editar proveedor"
                                    >
                                      <Edit size={20} />
                                    </button>

                                    {/* Botón de Activar/Desactivar */}
                                    <button
                                      onClick={() => {
                                        const updatedCompanies =
                                          registeredCompanies.map((c) =>
                                            c.id === company.id
                                              ? { ...c, activo: !c.activo }
                                              : c,
                                          );
                                        setRegisteredCompanies(
                                          updatedCompanies,
                                        );

                                        if (
                                          company.tipoEmpresa === "hospedaje"
                                        ) {
                                          setMasterHotels(
                                            masterHotels.map((h) =>
                                              h.name === company.razonSocial
                                                ? {
                                                    ...h,
                                                    activo: !company.activo,
                                                  }
                                                : h,
                                            ),
                                          );
                                        } else if (
                                          company.tipoEmpresa === "transporte"
                                        ) {
                                          setMasterTransports(
                                            masterTransports.map((t) =>
                                              t.name === company.razonSocial
                                                ? {
                                                    ...t,
                                                    activo: !company.activo,
                                                  }
                                                : t,
                                            ),
                                          );
                                        } else if (
                                          company.tipoEmpresa === "alimentacion"
                                        ) {
                                          setMasterRestaurants(
                                            masterRestaurants.map((r) =>
                                              r.name === company.razonSocial
                                                ? {
                                                    ...r,
                                                    activo: !company.activo,
                                                  }
                                                : r,
                                            ),
                                          );
                                        }
                                      }}
                                      className={`p-2 rounded-lg transition ${
                                        company.activo
                                          ? "bg-yellow-100 hover:bg-yellow-200 text-yellow-700"
                                          : "bg-green-100 hover:bg-green-200 text-green-700"
                                      }`}
                                      title={
                                        company.activo
                                          ? "Desactivar"
                                          : "Activar"
                                      }
                                    >
                                      {company.activo ? (
                                        <EyeOff size={20} />
                                      ) : (
                                        <Eye size={20} />
                                      )}
                                    </button>
                                  </div>
                                </div>

                                {/* Detalles del proveedor */}
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                                  <div className="flex items-center gap-2">
                                    <FileText
                                      className={
                                        company.activo
                                          ? "text-slate-400"
                                          : "text-slate-300"
                                      }
                                      size={16}
                                    />
                                    <span
                                      className={`break-all ${company.activo ? "text-slate-600" : "text-slate-400"}`}
                                    >
                                      <span className="font-semibold">
                                        RUC:
                                      </span>{" "}
                                      {company.ruc}
                                    </span>
                                  </div>

                                  <div className="flex items-start gap-2 md:col-span-2">
                                    <MapPin
                                      className={`${
                                        company.activo
                                          ? "text-slate-400"
                                          : "text-slate-300"
                                      } mt-0.5 flex-shrink-0`}
                                      size={16}
                                    />
                                    <span
                                      className={`break-words ${company.activo ? "text-slate-600" : "text-slate-400"}`}
                                    >
                                      {company.direccion}
                                    </span>
                                  </div>

                                  {company.telefono && (
                                    <div className="flex items-center gap-2">
                                      <Phone
                                        className={
                                          company.activo
                                            ? "text-slate-400"
                                            : "text-slate-300"
                                        }
                                        size={16}
                                      />
                                      <span
                                        className={`break-all ${company.activo ? "text-slate-600" : "text-slate-400"}`}
                                      >
                                        {company.telefono}
                                      </span>
                                    </div>
                                  )}

                                  {company.email && (
                                    <div className="flex items-center gap-2 sm:col-span-2">
                                      <Mail
                                        className={
                                          company.activo
                                            ? "text-slate-400"
                                            : "text-slate-300"
                                        }
                                        size={16}
                                      />
                                      <span
                                        className={`break-all ${company.activo ? "text-slate-600" : "text-slate-400"}`}
                                      >
                                        {company.email}
                                      </span>
                                    </div>
                                  )}
                                </div>
                              </div>
                            ))}
                        </div>
                      ) : (
                        <div className="text-center py-12">
                          <Building className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                          <p className="text-slate-600">
                            {registeredCompanies.length === 0
                              ? "No hay proveedores registrados aún"
                              : "No se encontraron resultados con los filtros aplicados"}
                          </p>
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>
        </div>

        {/* ✅✅✅ AGREGAR EL MODAL AQUÍ ✅✅✅ */}
        {showDuplicatePNRModal && (
          <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-scale-in">
              {/* Header con degradado */}
              <div className="bg-gradient-to-r from-red-600 to-orange-600 text-white px-6 py-4">
                <h3 className="text-xl font-bold">Boarding Pass Ya Generado</h3>
              </div>

              {/* Contenido */}
              <div className="p-6">
                <div className="flex items-center gap-4 mb-6">
                  <div className="bg-red-100 w-16 h-16 rounded-full flex items-center justify-center flex-shrink-0">
                    <AlertTriangle className="w-8 h-8 text-red-600" />
                  </div>
                  <div>
                    <h4 className="text-lg font-bold text-slate-800 mb-1">
                      ⚠️ PNR Duplicado Detectado
                    </h4>
                    <p className="text-sm text-slate-600">
                      <span className="font-semibold">PNR:</span>{" "}
                      <span className="font-mono text-red-600">
                        {duplicatePNRInfo?.pnr}
                      </span>
                    </p>
                    <p className="text-sm text-slate-600">
                      <span className="font-semibold">Pasajero:</span>{" "}
                      {duplicatePNRInfo?.name}
                    </p>
                  </div>
                </div>

                <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                  <p className="text-red-800 font-semibold text-sm">
                    Este boarding pass ya tiene un voucher generado
                  </p>
                </div>

                <p className="text-slate-700 text-sm">
                  No se puede escanear el mismo boarding pass dos veces. Por
                  favor, escanee un boarding pass diferente.
                </p>
              </div>

              {/* Footer con botón */}
              <div className="px-6 pb-6">
                <button
                  onClick={() => {
                    setShowDuplicatePNRModal(false);
                    setDuplicatePNRInfo(null);
                  }}
                  className="w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-3 rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 active:translate-y-0"
                >
                  Entendido
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Estilos de animación */}
        <style>{`
          @keyframes scale-in {
            from {
              opacity: 0;
              transform: scale(0.9);
            }
            to {
              opacity: 1;
              transform: scale(1);
            }
          }
          .animate-scale-in {
            animation: scale-in 0.2s ease-out;
          }
        `}</style>
      </div>
    );
  }

  return null;
}
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AirportApp />);
    </script>
</body>
</html>
